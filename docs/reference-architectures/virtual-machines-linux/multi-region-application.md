---
title: Ejecución de máquinas virtuales Linux en varias regiones de Azure para conseguir alta disponibilidad
description: Cómo implementar máquinas virtuales en varias regiones de Azure para conseguir alta disponibilidad y resistencia.
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Linux VM workloads
pnp.series.prev: n-tier
ms.openlocfilehash: 07ccf44f28203e6d5001475b47adce01437e9600
ms.sourcegitcommit: c441fd165e6bebbbbbc19854ec6f3676be9c3b25
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/30/2018
---
# <a name="run-linux-vms-in-multiple-regions-for-high-availability"></a><span data-ttu-id="82338-103">Ejecución de máquinas virtuales Linux en varias regiones para conseguir alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="82338-103">Run Linux VMs in multiple regions for high availability</span></span>

<span data-ttu-id="82338-104">Esta arquitectura de referencia muestra un conjunto de procedimientos de demostrada eficacia para la ejecución de una aplicación de N niveles en varias regiones de Azure, con la finalidad de conseguir disponibilidad y una sólida estructura de recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="82338-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span> 

<span data-ttu-id="82338-105">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="82338-105">![[0]][0]</span></span>

<span data-ttu-id="82338-106">*Descargue un [archivo Visio][visio-download] de esta arquitectura.*</span><span class="sxs-lookup"><span data-stu-id="82338-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="82338-107">Architecture</span><span class="sxs-lookup"><span data-stu-id="82338-107">Architecture</span></span> 

<span data-ttu-id="82338-108">Esta arquitectura se basa en la que se muestra en [Run Linux VMs for an N-tier application](n-tier.md) (Ejecución de máquinas virtuales Linux para una aplicación de N niveles).</span><span class="sxs-lookup"><span data-stu-id="82338-108">This architecture builds on the one shown in [Run Linux VMs for an N-tier application](n-tier.md).</span></span> 

* <span data-ttu-id="82338-109">**Regiones primarias y secundarias**</span><span class="sxs-lookup"><span data-stu-id="82338-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="82338-110">Use dos regiones para lograr una mayor disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="82338-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="82338-111">Una es la región primaria y la otra para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="82338-111">One is the primary region.The other region is for failover.</span></span>
* <span data-ttu-id="82338-112">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="82338-112">**Azure DNS**.</span></span> <span data-ttu-id="82338-113">[Azure DNS][azure-dns] es un servicio de hospedaje para dominios DNS que permite resolver nombres mediante la infraestructura de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="82338-113">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="82338-114">Al hospedar dominios en Azure, puede administrar los registros DNS con las mismas credenciales, API, herramientas y facturación que con los demás servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="82338-114">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="82338-115">**Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="82338-115">**Azure Traffic Manager**.</span></span> <span data-ttu-id="82338-116">[Traffic Manager][traffic-manager] enruta las solicitudes entrantes a una de las regiones.</span><span class="sxs-lookup"><span data-stu-id="82338-116">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="82338-117">Durante las operaciones normales enruta las solicitudes a la región primaria.</span><span class="sxs-lookup"><span data-stu-id="82338-117">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="82338-118">Si dicha región no está disponible, Traffic Manager conmuta por error a la región secundaria.</span><span class="sxs-lookup"><span data-stu-id="82338-118">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="82338-119">Para más información, consulte la sección [Configuración de Traffic Manager](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="82338-119">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>
* <span data-ttu-id="82338-120">**Grupos de recursos**.</span><span class="sxs-lookup"><span data-stu-id="82338-120">**Resource groups**.</span></span> <span data-ttu-id="82338-121">Cree [grupos de recursos][resource groups] independientes para la región primaria, la región secundaria y para Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="82338-121">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="82338-122">De esta manera, obtiene la flexibilidad para administrar cada región como una única colección de recursos.</span><span class="sxs-lookup"><span data-stu-id="82338-122">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="82338-123">Por ejemplo, podría volver a implementar una región, sin quitar la otra.</span><span class="sxs-lookup"><span data-stu-id="82338-123">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="82338-124">[Vincule los grupos de recursos][resource-group-links], de modo que pueda ejecutar una consulta para obtener una lista de todos los recursos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="82338-124">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>
* <span data-ttu-id="82338-125">**Redes virtuales**.</span><span class="sxs-lookup"><span data-stu-id="82338-125">**VNets**.</span></span> <span data-ttu-id="82338-126">Cree una red virtual independiente para cada región.</span><span class="sxs-lookup"><span data-stu-id="82338-126">Create a separate VNet for each region.</span></span> <span data-ttu-id="82338-127">Asegúrese de que los espacios de direcciones no se superpongan.</span><span class="sxs-lookup"><span data-stu-id="82338-127">Make sure the address spaces do not overlap.</span></span>
* <span data-ttu-id="82338-128">**Apache Cassandra**.</span><span class="sxs-lookup"><span data-stu-id="82338-128">**Apache Cassandra**.</span></span> <span data-ttu-id="82338-129">Implemente Casandra en centros de datos en regiones de Azure para lograr alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="82338-129">Deploy Cassandra in data centers across Azure regions for high availability.</span></span> <span data-ttu-id="82338-130">Dentro de cada región, los nodos están configurados en modo compatible con bastidor con dominios de error y actualización, para proporcionar resistencia dentro de la región.</span><span class="sxs-lookup"><span data-stu-id="82338-130">Within each region, nodes are configured in rack-aware mode with fault and upgrade domains, for resiliency inside the region.</span></span>

## <a name="recommendations"></a><span data-ttu-id="82338-131">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="82338-131">Recommendations</span></span>

<span data-ttu-id="82338-132">Una arquitectura de varias regiones puede proporcionar una mayor disponibilidad que la implementación en una sola región.</span><span class="sxs-lookup"><span data-stu-id="82338-132">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="82338-133">Si una interrupción regional afecta a la región primaria, puede usar [Traffic Manager][traffic-manager] para conmutar por error en la región secundaria.</span><span class="sxs-lookup"><span data-stu-id="82338-133">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="82338-134">Esta arquitectura también puede ayudar si un determinado subsistema de la aplicación produce un error.</span><span class="sxs-lookup"><span data-stu-id="82338-134">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="82338-135">Existen varios enfoques generales para lograr una alta disponibilidad en regiones:</span><span class="sxs-lookup"><span data-stu-id="82338-135">There are several general approaches to achieving high availability across regions:</span></span>   

* <span data-ttu-id="82338-136">Activo/pasivo con espera activa.</span><span class="sxs-lookup"><span data-stu-id="82338-136">Active/passive with hot standby.</span></span> <span data-ttu-id="82338-137">Un tráfico se dirige a una región, mientras el otro se encuentra en espera activa.</span><span class="sxs-lookup"><span data-stu-id="82338-137">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="82338-138">Espera activa significa que las máquinas virtuales de la región secundaria están siempre asignadas y en funcionamiento.</span><span class="sxs-lookup"><span data-stu-id="82338-138">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="82338-139">Activo/pasivo con espera pasiva.</span><span class="sxs-lookup"><span data-stu-id="82338-139">Active/passive with cold standby.</span></span> <span data-ttu-id="82338-140">El tráfico se dirige a una región, mientras el otro se encuentra en espera pasiva.</span><span class="sxs-lookup"><span data-stu-id="82338-140">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="82338-141">Espera pasiva significa que las máquinas virtuales de la región secundaria no se asignan hasta que son necesarias para una conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="82338-141">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="82338-142">Este enfoque tiene un coste menor de ejecución, pero generalmente tarda más en ponerse en línea durante un error.</span><span class="sxs-lookup"><span data-stu-id="82338-142">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="82338-143">Activo/activo.</span><span class="sxs-lookup"><span data-stu-id="82338-143">Active/active.</span></span> <span data-ttu-id="82338-144">Ambas regiones están activas y se equilibra la carga de las solicitudes entre ellas.</span><span class="sxs-lookup"><span data-stu-id="82338-144">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="82338-145">Si una región no está disponible, se saca de la rotación.</span><span class="sxs-lookup"><span data-stu-id="82338-145">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="82338-146">El enfoque de esta arquitectura es activo/pasivo con espera activa, con Traffic Manager para la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="82338-146">This architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="82338-147">Tenga en cuenta que podría implementar un número pequeño de máquinas virtuales para la espera activa y luego escalarlas horizontalmente si es necesario.</span><span class="sxs-lookup"><span data-stu-id="82338-147">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>


### <a name="regional-pairing"></a><span data-ttu-id="82338-148">Emparejamiento regional</span><span class="sxs-lookup"><span data-stu-id="82338-148">Regional pairing</span></span>

<span data-ttu-id="82338-149">Cada región de Azure se empareja con otra región de la misma zona geográfica.</span><span class="sxs-lookup"><span data-stu-id="82338-149">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="82338-150">En general, elija regiones del mismo par de regional (por ejemplo, Este de EE. UU. 2 y Centro de EE. UU.).</span><span class="sxs-lookup"><span data-stu-id="82338-150">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="82338-151">Las ventajas de hacerlo son:</span><span class="sxs-lookup"><span data-stu-id="82338-151">Benefits of doing so include:</span></span>

* <span data-ttu-id="82338-152">Si se produce una interrupción prolongada, se establece como prioridad la recuperación de al menos una región de cada par.</span><span class="sxs-lookup"><span data-stu-id="82338-152">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="82338-153">Las actualizaciones planeadas del sistema de Azure se implementan en las regiones emparejadas de manera secuencial para reducir el posible tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="82338-153">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
* <span data-ttu-id="82338-154">Los pares residen dentro de la misma zona geográfica, de forma que se cumplen los requisitos de residencia de los datos.</span><span class="sxs-lookup"><span data-stu-id="82338-154">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="82338-155">Sin embargo, asegúrese de que ambas regiones admitan todos los servicios de Azure que necesita su aplicación (consulte [Servicios por región][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="82338-155">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="82338-156">Para más información sobre los pares regionales, consulte [Continuidad empresarial y recuperación ante desastres (BCDR): regiones emparejadas de Azure][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="82338-156">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="82338-157">Configuración de Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="82338-157">Traffic Manager configuration</span></span>

<span data-ttu-id="82338-158">Al configurar Traffic Manager, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="82338-158">Consider the following points when configuring Traffic Manager:</span></span>

* <span data-ttu-id="82338-159">**Enrutamiento**.</span><span class="sxs-lookup"><span data-stu-id="82338-159">**Routing**.</span></span> <span data-ttu-id="82338-160">Traffic Manager admite varios [algoritmos de enrutamiento][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="82338-160">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="82338-161">Para el escenario descrito en este artículo, use el enrutamiento de *prioridad* (anteriormente conocido como enrutamiento de *conmutación por error*).</span><span class="sxs-lookup"><span data-stu-id="82338-161">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="82338-162">Con esta configuración, Traffic Manager envía todas las solicitudes a la región primaria, a no ser que no sea posible comunicarse con ella.</span><span class="sxs-lookup"><span data-stu-id="82338-162">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="82338-163">En ese momento, conmuta por error automáticamente a la región secundaria.</span><span class="sxs-lookup"><span data-stu-id="82338-163">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="82338-164">Consulte [Configuración del método de conmutación por error][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="82338-164">See [Configure Failover routing method][tm-configure-failover].</span></span>
* <span data-ttu-id="82338-165">**Sondeo de mantenimiento**.</span><span class="sxs-lookup"><span data-stu-id="82338-165">**Health probe**.</span></span> <span data-ttu-id="82338-166">Traffic Manager usa un [sondeo][tm-monitoring] HTTP (o HTTPS) para supervisar la disponibilidad de cada región.</span><span class="sxs-lookup"><span data-stu-id="82338-166">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="82338-167">El sondeo comprueba si hay una respuesta HTTP 200 para una ruta de acceso de dirección URL especificada.</span><span class="sxs-lookup"><span data-stu-id="82338-167">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="82338-168">Como procedimiento recomendado, cree un punto de conexión que indique el estado general de la aplicación y úselo para el sondeo de estado.</span><span class="sxs-lookup"><span data-stu-id="82338-168">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="82338-169">En caso contrario, el sondeo podría informar de un punto de conexión correcto cuando realmente se producen errores en partes críticas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="82338-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="82338-170">Para más información, consulte [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern] (Patrón Health Endpoint Monitoring).</span><span class="sxs-lookup"><span data-stu-id="82338-170">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="82338-171">Cuando Traffic Manager conmuta por error, hay un período de tiempo en que los clientes no pueden comunicarse con la aplicación.</span><span class="sxs-lookup"><span data-stu-id="82338-171">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="82338-172">La duración viene determinada por los siguientes factores:</span><span class="sxs-lookup"><span data-stu-id="82338-172">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="82338-173">El sondeo de estado debe detectar que la región primaria se ha vuelto inaccesible.</span><span class="sxs-lookup"><span data-stu-id="82338-173">The health probe must detect that the primary region has become unreachable.</span></span>
* <span data-ttu-id="82338-174">Los servidores DNS deben actualizar los registros DNS almacenados en caché con la dirección IP, lo cual depende del período de vida (TTL) de DNS.</span><span class="sxs-lookup"><span data-stu-id="82338-174">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="82338-175">El TTL predeterminado es de 300 segundos (5 minutos), pero puede configurar este valor al crear el perfil de Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="82338-175">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="82338-176">Para más información, consulte [Acerca de la supervisión de Traffic Manager][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="82338-176">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="82338-177">Si Traffic Manager conmuta por error, se recomienda realizar una conmutación por recuperación manual en lugar de implementar una automática.</span><span class="sxs-lookup"><span data-stu-id="82338-177">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="82338-178">En caso contrario, puede crear una situación donde la aplicación va y viene incesantemente entre regiones.</span><span class="sxs-lookup"><span data-stu-id="82338-178">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="82338-179">Compruebe que todos los subsistemas de aplicación tengan un estado correcto antes de la conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="82338-179">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="82338-180">Tenga en cuenta que Traffic Manager conmuta por recuperación automáticamente de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="82338-180">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="82338-181">Para evitar esto, reduzca manualmente la prioridad de la región primaria después de un evento de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="82338-181">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="82338-182">Por ejemplo, suponga que la región primaria tiene la prioridad 1 y la secundaria la prioridad 2.</span><span class="sxs-lookup"><span data-stu-id="82338-182">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="82338-183">Después de una conmutación por error, establezca la región primaria en la prioridad 3 para evitar la conmutación por recuperación automática.</span><span class="sxs-lookup"><span data-stu-id="82338-183">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="82338-184">Cuando esté listo para cambiar de nuevo, actualice la prioridad a 1.</span><span class="sxs-lookup"><span data-stu-id="82338-184">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="82338-185">El siguiente comando de la [CLI de Azure][install-azure-cli] actualiza la prioridad:</span><span class="sxs-lookup"><span data-stu-id="82338-185">The following [Azure CLI][install-azure-cli] command updates the priority:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --priority 3
```    

<span data-ttu-id="82338-186">Otro enfoque consiste en deshabilitar temporalmente el punto de conexión hasta que esté listo para conmutar por recuperación:</span><span class="sxs-lookup"><span data-stu-id="82338-186">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --status Disabled
```    

<span data-ttu-id="82338-187">Dependiendo de la causa de una conmutación por error, tendrá que volver a implementar los recursos dentro de una región.</span><span class="sxs-lookup"><span data-stu-id="82338-187">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="82338-188">Antes de proceder a la conmutación por recuperación, realice una prueba de preparación operativa.</span><span class="sxs-lookup"><span data-stu-id="82338-188">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="82338-189">La prueba debe comprobar aspectos como:</span><span class="sxs-lookup"><span data-stu-id="82338-189">The test should verify things like:</span></span>

* <span data-ttu-id="82338-190">Máquinas virtuales configuradas correctamente.</span><span class="sxs-lookup"><span data-stu-id="82338-190">VMs are configured correctly.</span></span> <span data-ttu-id="82338-191">(Todo el software necesario está instalado, IIS está en funcionamiento, etc.).</span><span class="sxs-lookup"><span data-stu-id="82338-191">(All required software is installed, IIS is running, and so on.)</span></span>
* <span data-ttu-id="82338-192">El estado de los subsistemas de aplicación es correcto.</span><span class="sxs-lookup"><span data-stu-id="82338-192">Application subsystems are healthy.</span></span>
* <span data-ttu-id="82338-193">Pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="82338-193">Functional testing.</span></span> <span data-ttu-id="82338-194">(Por ejemplo, la capa de base de datos es accesible desde la capa web).</span><span class="sxs-lookup"><span data-stu-id="82338-194">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="cassandra-deployment-across-multiple-regions"></a><span data-ttu-id="82338-195">Implementación de Cassandra en varias regiones</span><span class="sxs-lookup"><span data-stu-id="82338-195">Cassandra deployment across multiple regions</span></span>

<span data-ttu-id="82338-196">Los centros de datos de Cassandra son un grupo de nodos de datos relacionados que se configuran juntos dentro de un clúster para la replicación y la segregación de la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="82338-196">Cassandra data centers are a group of related data nodes that are configured together within a cluster for replication and workload segregation.</span></span>

<span data-ttu-id="82338-197">Se recomienda [DataStax Enterprise][datastax] para su uso en producción.</span><span class="sxs-lookup"><span data-stu-id="82338-197">We recommend [DataStax Enterprise][datastax] for production use.</span></span> <span data-ttu-id="82338-198">Para más información sobre cómo ejecutar DataStax en Azure, consulte [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure] (Guía de implementación de DataStax Enterprise Deployment para Azure).</span><span class="sxs-lookup"><span data-stu-id="82338-198">For more information on running DataStax in Azure, see [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure].</span></span> <span data-ttu-id="82338-199">Las siguientes recomendaciones generales se aplican a cualquier edición de Cassandra:</span><span class="sxs-lookup"><span data-stu-id="82338-199">The following general recommendations apply to any Cassandra edition:</span></span> 

* <span data-ttu-id="82338-200">Asigne una dirección IP pública a cada nodo.</span><span class="sxs-lookup"><span data-stu-id="82338-200">Assign a public IP address to each node.</span></span> <span data-ttu-id="82338-201">De esta manera, los clústeres se pueden comunicar entre regiones mediante la infraestructura base de Azure, lo que proporciona un alto rendimiento a un coste bajo.</span><span class="sxs-lookup"><span data-stu-id="82338-201">This enables the clusters to communicate across regions using the Azure backbone infrastructure, providing high throughput at low cost.</span></span>
* <span data-ttu-id="82338-202">Proteja los nodos con las configuraciones adecuadas de firewall y grupo de seguridad de red (NSG) para permitir solo el tráfico que entra y sale de hosts conocidos, incluidos los clientes y otros nodos de clúster.</span><span class="sxs-lookup"><span data-stu-id="82338-202">Secure nodes using the appropriate firewall and network security group (NSG) configurations, allowing traffic only to and from known hosts, including clients and other cluster nodes.</span></span> <span data-ttu-id="82338-203">Tenga en cuenta que Cassandra usa distintos puertos para la comunicación, como OpsCenter, Spark, etc.</span><span class="sxs-lookup"><span data-stu-id="82338-203">Note that Cassandra uses different ports for communication, OpsCenter, Spark, and so forth.</span></span> <span data-ttu-id="82338-204">Para saber cómo usar los puertos en Cassandra, consulte [Configuring firewall port access][cassandra-ports] (Configuración del acceso a los puertos del firewall).</span><span class="sxs-lookup"><span data-stu-id="82338-204">For port usage in Cassandra, see [Configuring firewall port access][cassandra-ports].</span></span>
* <span data-ttu-id="82338-205">Use el cifrado SSL en todas las comunicaciones de [cliente a nodo][ssl-client-node] y de [nodo a nodo][ssl-node-node].</span><span class="sxs-lookup"><span data-stu-id="82338-205">Use SSL encryption for all [client-to-node][ssl-client-node] and [node-to-node][ssl-node-node] communications.</span></span>
* <span data-ttu-id="82338-206">Dentro de una región, siga las [recomendaciones de Cassandra](n-tier.md#cassandra).</span><span class="sxs-lookup"><span data-stu-id="82338-206">Within a region, follow the guidelines in [Cassandra recommendations](n-tier.md#cassandra).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="82338-207">Consideraciones sobre disponibilidad</span><span class="sxs-lookup"><span data-stu-id="82338-207">Availability considerations</span></span>

<span data-ttu-id="82338-208">Con una aplicación de N niveles compleja, no es necesario replicar toda la aplicación en la región secundaria.</span><span class="sxs-lookup"><span data-stu-id="82338-208">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="82338-209">En su lugar, puede replicar simplemente un subsistema crítico que sea necesario para permitir la continuidad empresarial.</span><span class="sxs-lookup"><span data-stu-id="82338-209">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="82338-210">Traffic Manager es un posible punto de error en el sistema.</span><span class="sxs-lookup"><span data-stu-id="82338-210">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="82338-211">Si se produce un error en Traffic Manager, los clientes no podrán acceder a la aplicación durante el tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="82338-211">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="82338-212">Revise el [SLA de Traffic Manager][tm-sla] y determine si el uso de Traffic Manager por sí solo cumple sus requisitos empresariales de alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="82338-212">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="82338-213">Si no es así, considere la posibilidad de agregar otra solución de administración de tráfico como una conmutación por recuperación.</span><span class="sxs-lookup"><span data-stu-id="82338-213">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="82338-214">Si el servicio Azure Traffic Manager no funciona, cambie los registros CNAME en DNS para que apunten a otro servicio de administración del tráfico.</span><span class="sxs-lookup"><span data-stu-id="82338-214">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="82338-215">(Este paso debe realizarse manualmente, y la aplicación dejará de estar disponible hasta que se propaguen los cambios de DNS).</span><span class="sxs-lookup"><span data-stu-id="82338-215">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="82338-216">En un clúster de Cassandra. los escenarios de conmutación por error que se deben tener en cuenta dependen de los niveles de coherencia usados por la aplicación, así como del número de réplicas utilizadas.</span><span class="sxs-lookup"><span data-stu-id="82338-216">For the Cassandra cluster, the failover scenarios to consider depend on the consistency levels used by the application, as well as the number of replicas used.</span></span> <span data-ttu-id="82338-217">Para más información sobre los niveles de coherencia y el uso en Cassandra, consulte [Configuring data consistency][cassandra-consistency] (Configuración de la coherencia de datos) y [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage] (Cassandra: ¿Con cuántos nodos se habla con cuórum?)</span><span class="sxs-lookup"><span data-stu-id="82338-217">For consistency levels and usage in Cassandra, see [Configuring data consistency][cassandra-consistency] and [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage]</span></span> <span data-ttu-id="82338-218">La disponibilidad de datos en Cassandra viene determinada por el nivel de coherencia usado por la aplicación y el mecanismo de replicación.</span><span class="sxs-lookup"><span data-stu-id="82338-218">Data availability in Cassandra is determined by the consistency level used by the application and the replication mechanism.</span></span> <span data-ttu-id="82338-219">Para más información sobre la replicación en Cassandra, consulte [Data Replication in NoSQL Databases Explained][cassandra-replication] (Explicación de la replicación de datos en bases de datos NoSQL).</span><span class="sxs-lookup"><span data-stu-id="82338-219">For replication in Cassandra, see [Data Replication in NoSQL Databases Explained][cassandra-replication].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="82338-220">Consideraciones sobre la manejabilidad</span><span class="sxs-lookup"><span data-stu-id="82338-220">Manageability considerations</span></span>

<span data-ttu-id="82338-221">Al actualizar la implementación, actualice una región cada vez para reducir la probabilidad de un error global derivado de una configuración incorrecta o un error en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="82338-221">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="82338-222">Pruebe la resistencia del sistema a los errores.</span><span class="sxs-lookup"><span data-stu-id="82338-222">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="82338-223">Estos son algunos escenarios comunes de error que se pueden probar:</span><span class="sxs-lookup"><span data-stu-id="82338-223">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="82338-224">Apagado de las instancias de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="82338-224">Shut down VM instances.</span></span>
* <span data-ttu-id="82338-225">Recursos de presión, como CPU y memoria.</span><span class="sxs-lookup"><span data-stu-id="82338-225">Pressure resources such as CPU and memory.</span></span>
* <span data-ttu-id="82338-226">Desconexión o retraso de la red.</span><span class="sxs-lookup"><span data-stu-id="82338-226">Disconnect/delay network.</span></span>
* <span data-ttu-id="82338-227">Bloqueo de procesos.</span><span class="sxs-lookup"><span data-stu-id="82338-227">Crash processes.</span></span>
* <span data-ttu-id="82338-228">Caducidad de certificados.</span><span class="sxs-lookup"><span data-stu-id="82338-228">Expire certificates.</span></span>
* <span data-ttu-id="82338-229">Simulación de errores de hardware.</span><span class="sxs-lookup"><span data-stu-id="82338-229">Simulate hardware faults.</span></span>
* <span data-ttu-id="82338-230">Apagado del servicio DNS en los controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="82338-230">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="82338-231">Medición de los tiempos de recuperación y comprobación de que cumplen los requisitos empresariales.</span><span class="sxs-lookup"><span data-stu-id="82338-231">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="82338-232">Pruebe también combinaciones de modos de error.</span><span class="sxs-lookup"><span data-stu-id="82338-232">Test combinations of failure modes, as well.</span></span>


<!-- Links -->
[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[cassandra-in-azure]: https://academy.datastax.com/resources/deployment-guide-azure
[cassandra-consistency]: http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html
[cassandra-replication]: http://www.planetcassandra.org/data-replication-in-nosql-databases-explained/
[cassandra-consistency-usage]: https://medium.com/@foundev/cassandra-how-many-nodes-are-talked-to-with-quorum-also-should-i-use-it-98074e75d7d5#.b4pb4alb2
[cassandra-ports]: https://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/sec/configFirewallPorts.html
[datastax]: https://www.datastax.com/products/datastax-enterprise
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[install-azure-cli]: /azure/xplat-cli-install
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[services-by-region]: https://azure.microsoft.com/regions/#services
[ssl-client-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLClientToNode_t.html
[ssl-node-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLNodeToNode_t.html
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
[0]: ./images/multi-region-application-diagram.png "Arquitectura de red de alta disponibilidad para aplicaciones de N niveles en Azure"
