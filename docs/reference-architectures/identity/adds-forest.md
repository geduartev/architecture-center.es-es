---
title: Creación de un bosque de recursos AD DS en Azure
description: >-
  Cómo crear un dominio de confianza de Active Directory en Azure.

  guidance,vpn-gateway,expressroute,load-balancer,virtual-network,active-directory
author: telmosampaio
ms.date: 11/28/2016
pnp.series.title: Identity management
pnp.series.prev: adds-extend-domain
pnp.series.next: adfs
cardTitle: Create an AD DS forest in Azure
ms.openlocfilehash: e32a6420821e70c84e77d2c39614f0c45efbb7e2
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 04/06/2018
---
# <a name="create-an-active-directory-domain-services-ad-ds-resource-forest-in-azure"></a><span data-ttu-id="e3664-104">Creación de un bosque de recursos de Active Directory Domain Services (AD DS) en Azure</span><span class="sxs-lookup"><span data-stu-id="e3664-104">Create an Active Directory Domain Services (AD DS) resource forest in Azure</span></span>

<span data-ttu-id="e3664-105">Esta arquitectura de referencia muestra cómo crear un dominio de Active Directory independiente en Azure en el que confíen los dominios del bosque de AD local.</span><span class="sxs-lookup"><span data-stu-id="e3664-105">This reference architecture shows how to create a separate Active Directory domain in Azure that is trusted by domains in your on-premises AD forest.</span></span> [<span data-ttu-id="e3664-106">**Implemente esta solución**.</span><span class="sxs-lookup"><span data-stu-id="e3664-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="e3664-107">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="e3664-107">[![0]][0]</span></span> 

<span data-ttu-id="e3664-108">*Descargue un [archivo Visio][visio-download] de esta arquitectura.*</span><span class="sxs-lookup"><span data-stu-id="e3664-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="e3664-109">Active Directory Domain Services (AD DS) almacena información de identidad en una estructura jerárquica.</span><span class="sxs-lookup"><span data-stu-id="e3664-109">Active Directory Domain Services (AD DS) stores identity information in a hierarchical structure.</span></span> <span data-ttu-id="e3664-110">El nodo superior de la estructura jerárquica se conoce como bosque.</span><span class="sxs-lookup"><span data-stu-id="e3664-110">The top node in the hierarchical structure is known as a forest.</span></span> <span data-ttu-id="e3664-111">Un bosque contiene dominios y los dominios contienen otros tipos de objetos.</span><span class="sxs-lookup"><span data-stu-id="e3664-111">A forest contains domains, and domains contain other types of objects.</span></span> <span data-ttu-id="e3664-112">Esta arquitectura de referencia crea un bosque de AD DS en Azure con una relación de confianza saliente unidireccional con un dominio local.</span><span class="sxs-lookup"><span data-stu-id="e3664-112">This reference architecture creates an AD DS forest in Azure with a one-way outgoing trust relationship with an on-premises domain.</span></span> <span data-ttu-id="e3664-113">El bosque en Azure contiene un dominio que no existe en el entorno local.</span><span class="sxs-lookup"><span data-stu-id="e3664-113">The forest in Azure contains a domain that does not exist on-premises.</span></span> <span data-ttu-id="e3664-114">Debido a la relación de confianza, se puede confiar en los inicios de sesión realizados en los dominios locales para acceder a los recursos del dominio de Azure independiente.</span><span class="sxs-lookup"><span data-stu-id="e3664-114">Because of the trust relationship, logons made against on-premises domains can be trusted for access to resources in the separate Azure domain.</span></span> 

<span data-ttu-id="e3664-115">Los usos habituales de esta arquitectura incluyen el mantenimiento de la separación de seguridad de objetos e identidades mantenida en la nube y la migración de dominios individuales del entorno local a la nube.</span><span class="sxs-lookup"><span data-stu-id="e3664-115">Typical uses for this architecture include maintaining security separation for objects and identities held in the cloud, and migrating individual domains from on-premises to the cloud.</span></span> 

<span data-ttu-id="e3664-116">Para consideraciones adicionales, consulte [Selección de una solución para la integración de Active Directory local con Azure][considerations].</span><span class="sxs-lookup"><span data-stu-id="e3664-116">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span> 

## <a name="architecture"></a><span data-ttu-id="e3664-117">Architecture</span><span class="sxs-lookup"><span data-stu-id="e3664-117">Architecture</span></span>

<span data-ttu-id="e3664-118">La arquitectura tiene los siguientes componentes.</span><span class="sxs-lookup"><span data-stu-id="e3664-118">The architecture has the following components.</span></span>

* <span data-ttu-id="e3664-119">**Red local**</span><span class="sxs-lookup"><span data-stu-id="e3664-119">**On-premises network**.</span></span> <span data-ttu-id="e3664-120">La red local contiene su propio bosque y dominios de Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e3664-120">The on-premises network contains its own Active Directory forest and domains.</span></span>
* <span data-ttu-id="e3664-121">**Servidores de Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="e3664-121">**Active Directory servers**.</span></span> <span data-ttu-id="e3664-122">Son controladores de dominio que implementan servicios de dominio que se ejecutan como máquinas virtuales en la nube.</span><span class="sxs-lookup"><span data-stu-id="e3664-122">These are domain controllers implementing domain services running as VMs in the cloud.</span></span> <span data-ttu-id="e3664-123">Estos servidores hospedan un bosque que contiene uno o varios dominios, que están separados de aquellos ubicados en el entorno local.</span><span class="sxs-lookup"><span data-stu-id="e3664-123">These servers host a forest containing one or more domains, separate from those located on-premises.</span></span>
* <span data-ttu-id="e3664-124">**Relación de confianza unidireccional**.</span><span class="sxs-lookup"><span data-stu-id="e3664-124">**One-way trust relationship**.</span></span> <span data-ttu-id="e3664-125">El ejemplo del diagrama muestra una confianza unidireccional entre el dominio de Azure y el dominio local.</span><span class="sxs-lookup"><span data-stu-id="e3664-125">The example in the diagram shows a one-way trust from the domain in Azure to the on-premises domain.</span></span> <span data-ttu-id="e3664-126">Esta relación permite que los usuarios locales accedan a los recursos que hay en el dominio de Azure, pero no al revés.</span><span class="sxs-lookup"><span data-stu-id="e3664-126">This relationship enables on-premises users to access resources in the domain in Azure, but not the other way around.</span></span> <span data-ttu-id="e3664-127">Es posible crear una confianza bidireccional si los usuarios de la nube también necesitan acceso a los recursos locales.</span><span class="sxs-lookup"><span data-stu-id="e3664-127">It is possible to create a two-way trust if cloud users also require access to on-premises resources.</span></span>
* <span data-ttu-id="e3664-128">**Subred de Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="e3664-128">**Active Directory subnet**.</span></span> <span data-ttu-id="e3664-129">Los servidores de AD DS se hospedan en una subred independiente.</span><span class="sxs-lookup"><span data-stu-id="e3664-129">The AD DS servers are hosted in a separate subnet.</span></span> <span data-ttu-id="e3664-130">Las reglas de grupo de seguridad de red (NSG) protegen los servidores de AD DS y proporcionan un firewall contra el tráfico de orígenes inesperados.</span><span class="sxs-lookup"><span data-stu-id="e3664-130">Network security group (NSG) rules protect the AD DS servers and provide a firewall against traffic from unexpected sources.</span></span>
* <span data-ttu-id="e3664-131">**Puerta de enlace de Azure**.</span><span class="sxs-lookup"><span data-stu-id="e3664-131">**Azure gateway**.</span></span> <span data-ttu-id="e3664-132">La puerta de enlace de Azure proporciona una conexión entre la red local y la red virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="e3664-132">The Azure gateway provides a connection between the on-premises network and the Azure VNet.</span></span> <span data-ttu-id="e3664-133">Puede ser una [conexión VPN] [ azure-vpn-gateway] o de [Azure ExpressRoute][azure-expressroute].</span><span class="sxs-lookup"><span data-stu-id="e3664-133">This can be a [VPN connection][azure-vpn-gateway] or [Azure ExpressRoute][azure-expressroute].</span></span> <span data-ttu-id="e3664-134">Para más información, consulte [Implementación de una arquitectura de red híbrida segura en Azure][implementing-a-secure-hybrid-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="e3664-134">For more information, see [Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture].</span></span>

## <a name="recommendations"></a><span data-ttu-id="e3664-135">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="e3664-135">Recommendations</span></span>

<span data-ttu-id="e3664-136">Si necesita recomendaciones específicas sobre cómo implementar Active Directory en Azure, consulte los siguientes artículos:</span><span class="sxs-lookup"><span data-stu-id="e3664-136">For specific recommendations on implementing Active Directory in Azure, see the following articles:</span></span>

- <span data-ttu-id="e3664-137">[Extending Active Directory Domain Services (AD DS) to Azure][adds-extend-domain] (Extensión de Active Directory Domain Services (AD DS) a Azure).</span><span class="sxs-lookup"><span data-stu-id="e3664-137">[Extending Active Directory Domain Services (AD DS) to Azure][adds-extend-domain].</span></span> 
- <span data-ttu-id="e3664-138">[Directrices para implementar Windows Server Active Directory en Azure Virtual Machines][ad-azure-guidelines].</span><span class="sxs-lookup"><span data-stu-id="e3664-138">[Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines][ad-azure-guidelines].</span></span>

### <a name="trust"></a><span data-ttu-id="e3664-139">Trust</span><span class="sxs-lookup"><span data-stu-id="e3664-139">Trust</span></span>

<span data-ttu-id="e3664-140">Los dominios locales están dentro de un bosque diferente de los dominios en la nube.</span><span class="sxs-lookup"><span data-stu-id="e3664-140">The on-premises domains are contained within a different forest from the domains in the cloud.</span></span> <span data-ttu-id="e3664-141">Para permitir la autenticación de usuarios locales en la nube, los dominios de Azure deben confiar en el dominio de inicio de sesión del bosque local.</span><span class="sxs-lookup"><span data-stu-id="e3664-141">To enable authentication of on-premises users in the cloud, the domains in Azure must trust the logon domain in the on-premises forest.</span></span> <span data-ttu-id="e3664-142">De forma similar, si la nube proporciona un dominio de inicio de sesión para los usuarios externos, puede ser necesario que el bosque local confíe en el dominio en la nube.</span><span class="sxs-lookup"><span data-stu-id="e3664-142">Similarly, if the cloud provides a logon domain for external users, it may be necessary for the on-premises forest to trust the cloud domain.</span></span>

<span data-ttu-id="e3664-143">Puede establecer relaciones de confianza en el nivel de bosque mediante la [creación de confianzas de bosque][creating-forest-trusts], o en el nivel de dominio mediante la [creación de confianzas externas][creating-external-trusts].</span><span class="sxs-lookup"><span data-stu-id="e3664-143">You can establish trusts at the forest level by [creating forest trusts][creating-forest-trusts], or at the domain level by [creating external trusts][creating-external-trusts].</span></span> <span data-ttu-id="e3664-144">Una nivel de confianza de bosque crea una relación entre todos los dominios de los dos bosques.</span><span class="sxs-lookup"><span data-stu-id="e3664-144">A forest level trust creates a relationship between all domains in two forests.</span></span> <span data-ttu-id="e3664-145">Una confianza de nivel de dominio externo solo crea una relación entre dos dominios especificados.</span><span class="sxs-lookup"><span data-stu-id="e3664-145">An external domain level trust only creates a relationship between two specified domains.</span></span> <span data-ttu-id="e3664-146">Solo se deben crear confianzas de nivel de dominio externo entre dominios de diferentes bosques.</span><span class="sxs-lookup"><span data-stu-id="e3664-146">You should only create external domain level trusts between domains in different forests.</span></span>

<span data-ttu-id="e3664-147">Las relaciones de confianza pueden ser en un solo sentido (unidireccionales) o en ambos sentidos (bidireccionales):</span><span class="sxs-lookup"><span data-stu-id="e3664-147">Trusts can be unidirectional (one-way) or bidirectional (two-way):</span></span>

* <span data-ttu-id="e3664-148">Una confianza unidireccional permite a los usuarios de un dominio o bosque (conocido como el dominio o bosque *entrante* dominio o bosque) acceder a los recursos mantenidos en otro (el dominio o bosque *saliente*).</span><span class="sxs-lookup"><span data-stu-id="e3664-148">A one-way trust enables users in one domain or forest (known as the *incoming* domain or forest) to access the resources held in another (the *outgoing* domain or forest).</span></span>
* <span data-ttu-id="e3664-149">Una confianza bidireccional permite a los usuarios del dominio o bosque acceder a los recursos mantenidos en los otros.</span><span class="sxs-lookup"><span data-stu-id="e3664-149">A two-way trust enables users in either domain or forest to access resources held in the other.</span></span>

<span data-ttu-id="e3664-150">En la tabla siguiente se resumen las configuraciones de confianza para algunos escenarios sencillos:</span><span class="sxs-lookup"><span data-stu-id="e3664-150">The following table summarizes trust configurations for some simple scenarios:</span></span>

| <span data-ttu-id="e3664-151">Escenario</span><span class="sxs-lookup"><span data-stu-id="e3664-151">Scenario</span></span> | <span data-ttu-id="e3664-152">Confianza local</span><span class="sxs-lookup"><span data-stu-id="e3664-152">On-premises trust</span></span> | <span data-ttu-id="e3664-153">Confianza en la nube</span><span class="sxs-lookup"><span data-stu-id="e3664-153">Cloud trust</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e3664-154">Los usuarios locales necesitan acceso a los recursos de la nube, pero no al revés.</span><span class="sxs-lookup"><span data-stu-id="e3664-154">On-premises users require access to resources in the cloud, but not vice versa</span></span> |<span data-ttu-id="e3664-155">Unidireccional, entrante</span><span class="sxs-lookup"><span data-stu-id="e3664-155">One-way, incoming</span></span> |<span data-ttu-id="e3664-156">Unidireccional, saliente</span><span class="sxs-lookup"><span data-stu-id="e3664-156">One-way, outgoing</span></span> |
| <span data-ttu-id="e3664-157">Los usuarios de la nube necesitan acceso a los recursos ubicados en el entorno local, pero no al revés.</span><span class="sxs-lookup"><span data-stu-id="e3664-157">Users in the cloud require access to resources located on-premises, but not vice versa</span></span> |<span data-ttu-id="e3664-158">Unidireccional, saliente</span><span class="sxs-lookup"><span data-stu-id="e3664-158">One-way, outgoing</span></span> |<span data-ttu-id="e3664-159">Unidireccional, entrante</span><span class="sxs-lookup"><span data-stu-id="e3664-159">One-way, incoming</span></span> |
| <span data-ttu-id="e3664-160">Los usuarios de la nube y locales necesitan acceso a los recursos mantenidos en la nube y locales.</span><span class="sxs-lookup"><span data-stu-id="e3664-160">Users in the cloud and on-premises both requires access to resources held in the cloud and on-premises</span></span> |<span data-ttu-id="e3664-161">Bidireccional, entrante y saliente</span><span class="sxs-lookup"><span data-stu-id="e3664-161">Two-way, incoming and outgoing</span></span> |<span data-ttu-id="e3664-162">Bidireccional, entrante y saliente</span><span class="sxs-lookup"><span data-stu-id="e3664-162">Two-way, incoming and outgoing</span></span> |

## <a name="scalability-considerations"></a><span data-ttu-id="e3664-163">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="e3664-163">Scalability considerations</span></span>

<span data-ttu-id="e3664-164">Active Directory es escalable automáticamente para los controladores de dominio que forman parte del mismo dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-164">Active Directory is automatically scalable for domain controllers that are part of the same domain.</span></span> <span data-ttu-id="e3664-165">Las solicitudes se distribuyen entre todos los controladores de un dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-165">Requests are distributed across all controllers within a domain.</span></span> <span data-ttu-id="e3664-166">Si agrega otro controlador de dominio, este se sincroniza automáticamente con el dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-166">You can add another domain controller, and it synchronizes automatically with the domain.</span></span> <span data-ttu-id="e3664-167">No configure un equilibrador de carga independiente para dirigir el tráfico a los controladores dentro del dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-167">Do not configure a separate load balancer to direct traffic to controllers within the domain.</span></span> <span data-ttu-id="e3664-168">Asegúrese de que todos los controladores de dominio tengan suficientes recursos de memoria y almacenamiento para administrar la base de datos de dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-168">Ensure that all domain controllers have sufficient memory and storage resources to handle the domain database.</span></span> <span data-ttu-id="e3664-169">Iguale el tamaño de todas las máquinas virtuales de controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-169">Make all domain controller VMs the same size.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="e3664-170">Consideraciones sobre disponibilidad</span><span class="sxs-lookup"><span data-stu-id="e3664-170">Availability considerations</span></span>

<span data-ttu-id="e3664-171">Aprovisione al menos dos controladores de dominio para cada dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-171">Provision at least two domain controllers for each domain.</span></span> <span data-ttu-id="e3664-172">Esto permite la replicación automática entre servidores.</span><span class="sxs-lookup"><span data-stu-id="e3664-172">This enables automatic replication between servers.</span></span> <span data-ttu-id="e3664-173">Cree un conjunto de disponibilidad para las máquinas virtuales que actúan como servidores de Active Directory que administran cada dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-173">Create an availability set for the VMs acting as Active Directory servers handling each domain.</span></span> <span data-ttu-id="e3664-174">Coloque al menos dos servidores en este conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="e3664-174">Put at least two servers in this availability set.</span></span>

<span data-ttu-id="e3664-175">Además, considere la posibilidad de designar uno o más servidores de cada dominio como [maestro de operaciones en espera][standby-operations-masters] para los casos en que se produzca un error de conectividad a un servidor que actúa con el rol de operación de maestro único flexible (FSMO).</span><span class="sxs-lookup"><span data-stu-id="e3664-175">Also, consider designating one or more servers in each domain as [standby operations masters][standby-operations-masters] in case connectivity to a server acting as a flexible single master operation (FSMO) role fails.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="e3664-176">Consideraciones sobre la manejabilidad</span><span class="sxs-lookup"><span data-stu-id="e3664-176">Manageability considerations</span></span>

<span data-ttu-id="e3664-177">Para conocer las consideraciones sobre administración y supervisión, consulte [Extensión de Active Directory a Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="e3664-177">For information about management and monitoring considerations, see [Extending Active Directory to Azure][adds-extend-domain].</span></span> 
 
<span data-ttu-id="e3664-178">Para más información, consulte [Supervisión de Active Directory][monitoring_ad].</span><span class="sxs-lookup"><span data-stu-id="e3664-178">For additional information, see [Monitoring Active Directory][monitoring_ad].</span></span> <span data-ttu-id="e3664-179">Puede instalar herramientas como [Microsoft Systems Center][microsoft_systems_center] en un servidor de supervisión en la subred de administración para ayudar a realizar estas tareas.</span><span class="sxs-lookup"><span data-stu-id="e3664-179">You can install tools such as [Microsoft Systems Center][microsoft_systems_center] on a monitoring server in the management subnet to help perform these tasks.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="e3664-180">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="e3664-180">Security considerations</span></span>

<span data-ttu-id="e3664-181">Las confianzas de nivel de bosque son transitivas.</span><span class="sxs-lookup"><span data-stu-id="e3664-181">Forest level trusts are transitive.</span></span> <span data-ttu-id="e3664-182">Si establece una confianza de nivel de bosque entre un bosque local y un bosque en la nube, esta confianza se extiende a otros dominios nuevos creados en cualquiera de los bosques.</span><span class="sxs-lookup"><span data-stu-id="e3664-182">If you establish a forest level trust between an on-premises forest and a forest in the cloud, this trust is extended to other new domains created in either forest.</span></span> <span data-ttu-id="e3664-183">Si usa dominios para proporcionar separación por motivos de seguridad, considere la posibilidad de crear confianzas solo en el nivel de dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-183">If you use domains to provide separation for security purposes, consider creating trusts at the domain level only.</span></span> <span data-ttu-id="e3664-184">Las confianzas de nivel de dominio son no transitivas.</span><span class="sxs-lookup"><span data-stu-id="e3664-184">Domain level trusts are non-transitive.</span></span>

<span data-ttu-id="e3664-185">Para conocer las consideraciones sobre seguridad específicas de Active Directory, consulte la sección [Extensión de Active Directory a Azure][adds-extend-domain].</span><span class="sxs-lookup"><span data-stu-id="e3664-185">For Active Directory-specific security considerations, see the security considerations section in [Extending Active Directory to Azure][adds-extend-domain].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="e3664-186">Implementación de la solución</span><span class="sxs-lookup"><span data-stu-id="e3664-186">Deploy the solution</span></span>

<span data-ttu-id="e3664-187">Hay una solución disponible en [GitHub][github] para implementar esta arquitectura de referencia.</span><span class="sxs-lookup"><span data-stu-id="e3664-187">A solution is available on [GitHub][github] to deploy this reference architecture.</span></span> <span data-ttu-id="e3664-188">Necesitará la versión más reciente de la CLI de Azure para ejecutar el script de Powershell que implementa la solución.</span><span class="sxs-lookup"><span data-stu-id="e3664-188">You will need the latest version of the Azure CLI to run the Powershell script that deploys the solution.</span></span> <span data-ttu-id="e3664-189">Para implementar la arquitectura de referencia, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="e3664-189">To deploy the reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="e3664-190">Descargue o clone la carpeta de soluciones de [GitHub][github] en la máquina local.</span><span class="sxs-lookup"><span data-stu-id="e3664-190">Download or clone the solution folder from [GitHub][github] to your local machine.</span></span>

2. <span data-ttu-id="e3664-191">Abra la CLI de Azure y navegue hasta la carpeta local de la solución.</span><span class="sxs-lookup"><span data-stu-id="e3664-191">Open the Azure CLI and navigate to the local solution folder.</span></span>

3. <span data-ttu-id="e3664-192">Ejecute el siguiente comando:</span><span class="sxs-lookup"><span data-stu-id="e3664-192">Run the following command:</span></span>
   
    ```Powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> <mode>
    ```
   
    <span data-ttu-id="e3664-193">Reemplace `<subscription id>` con la identificación de su suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="e3664-193">Replace `<subscription id>` with your Azure subscription ID.</span></span>
   
    <span data-ttu-id="e3664-194">Para `<location>`, especifique una región de Azure, como `eastus` o `westus`.</span><span class="sxs-lookup"><span data-stu-id="e3664-194">For `<location>`, specify an Azure region, such as `eastus` or `westus`.</span></span>
   
    <span data-ttu-id="e3664-195">El parámetro `<mode>` controla la granularidad de la implementación y puede ser uno de los siguientes valores:</span><span class="sxs-lookup"><span data-stu-id="e3664-195">The `<mode>` parameter controls the granularity of the deployment, and can be one of the following values:</span></span>
   
   * <span data-ttu-id="e3664-196">`Onpremise`: implementa el entorno local simulado.</span><span class="sxs-lookup"><span data-stu-id="e3664-196">`Onpremise`: deploys the simulated on-premises environment.</span></span>
   * <span data-ttu-id="e3664-197">`Infrastructure`: implementa la infraestructura de VNet y el JumBox en Azure.</span><span class="sxs-lookup"><span data-stu-id="e3664-197">`Infrastructure`: deploys the VNet infrastructure and jump box in Azure.</span></span>
   * <span data-ttu-id="e3664-198">`CreateVpn`: implementa la puerta de enlace de red virtual de Azure y la conecta a la red local simulada.</span><span class="sxs-lookup"><span data-stu-id="e3664-198">`CreateVpn`: deploys the Azure virtual network gateway and connects it to the simulated on-premises network.</span></span>
   * <span data-ttu-id="e3664-199">`AzureADDS`: implementa las máquinas virtuales que actúan como servidores de Active Directory DS, implementa Active Directory en estas máquinas virtuales e implementa el dominio en Azure.</span><span class="sxs-lookup"><span data-stu-id="e3664-199">`AzureADDS`: deploys the VMs acting as Active Directory DS servers, deploys Active Directory to these VMs, and deploys the domain in Azure.</span></span>
   * <span data-ttu-id="e3664-200">`WebTier`: implementa las máquinas virtuales de nivel web y el equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="e3664-200">`WebTier`: deploys the web tier VMs and load balancer.</span></span>
   * <span data-ttu-id="e3664-201">`Prepare`: implementa todas las implementaciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="e3664-201">`Prepare`: deploys all of the preceding deployments.</span></span> <span data-ttu-id="e3664-202">**Esta es la opción recomendada si no tiene una red local existente pero quiere implementar la arquitectura de referencia completa que se ha descrito anteriormente para pruebas o evaluación.**</span><span class="sxs-lookup"><span data-stu-id="e3664-202">**This is the recommended option if If you do not have an existing on-premises network but you want to deploy the complete reference architecture described above for testing or evaluation.**</span></span> 
   * <span data-ttu-id="e3664-203">`Workload`: implementa las máquinas virtuales de capa de datos y empresa y los equilibradores de carga.</span><span class="sxs-lookup"><span data-stu-id="e3664-203">`Workload`: deploys the business and data tier VMs and load balancers.</span></span> <span data-ttu-id="e3664-204">Tenga en cuenta que estas máquinas virtuales no se incluyen en la implementación `Prepare`.</span><span class="sxs-lookup"><span data-stu-id="e3664-204">Note that these VMs are not included in the `Prepare` deployment.</span></span>

4. <span data-ttu-id="e3664-205">Espere a que la implementación se complete.</span><span class="sxs-lookup"><span data-stu-id="e3664-205">Wait for the deployment to complete.</span></span> <span data-ttu-id="e3664-206">Si va a realizar la implementación `Prepare`, tardará varias horas.</span><span class="sxs-lookup"><span data-stu-id="e3664-206">If you are deploying the `Prepare` deployment, it will take several hours.</span></span>
     
5. <span data-ttu-id="e3664-207">Si va a usar la configuración local simulada, configure la relación de confianza entrante:</span><span class="sxs-lookup"><span data-stu-id="e3664-207">If you are using the simulated on-premises configuration, configure the incoming trust relationship:</span></span>
   
   1. <span data-ttu-id="e3664-208">Conéctese al JumpBox (<em>ra-adtrust-mgmt-vm1</em> en el grupo de recursos <em>ra-adtrust-security-rg</em>).</span><span class="sxs-lookup"><span data-stu-id="e3664-208">Connect to the jump box (<em>ra-adtrust-mgmt-vm1</em> in the <em>ra-adtrust-security-rg</em> resource group).</span></span> <span data-ttu-id="e3664-209">Inicie sesión como <em>testuser</em> con la contraseña <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="e3664-209">Log in as <em>testuser</em> with password <em>AweS0me@PW</em>.</span></span>
   2. <span data-ttu-id="e3664-210">En el JumpBox, abra una sesión RDP en la primera máquina virtual del dominio <em>contoso.com</em> (el dominio local).</span><span class="sxs-lookup"><span data-stu-id="e3664-210">On the jump box open an RDP session on the first VM in the <em>contoso.com</em> domain (the on-premises domain).</span></span> <span data-ttu-id="e3664-211">Esta máquina virtual tiene la dirección IP 192.168.0.4.</span><span class="sxs-lookup"><span data-stu-id="e3664-211">This VM has the IP address 192.168.0.4.</span></span> <span data-ttu-id="e3664-212">El nombre de usuario es <em>contoso\testuser</em> y la contraseña <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="e3664-212">The username is <em>contoso\testuser</em> with password <em>AweS0me@PW</em>.</span></span>
   3. <span data-ttu-id="e3664-213">Descargue el script [incoming-trust.ps1][incoming-trust] y ejecútelo para crear la confianza entrante desde el dominio *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="e3664-213">Download the [incoming-trust.ps1][incoming-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span>

6. <span data-ttu-id="e3664-214">Si usa su propia infraestructura local:</span><span class="sxs-lookup"><span data-stu-id="e3664-214">If you are using your own on-premises infrastructure:</span></span>
   
   1. <span data-ttu-id="e3664-215">Descargue el script [incoming-trust.ps1][incoming-trust].</span><span class="sxs-lookup"><span data-stu-id="e3664-215">Download the [incoming-trust.ps1][incoming-trust] script.</span></span>
   2. <span data-ttu-id="e3664-216">Edítelo y reemplace el valor de la variable `$TrustedDomainName` por el nombre de su propio dominio.</span><span class="sxs-lookup"><span data-stu-id="e3664-216">Edit the script and replace the value of the `$TrustedDomainName` variable with the name of your own domain.</span></span>
   3. <span data-ttu-id="e3664-217">Ejecute el script.</span><span class="sxs-lookup"><span data-stu-id="e3664-217">Run the script.</span></span>

7. <span data-ttu-id="e3664-218">En el JumpBox, conéctese a la primera máquina virtual del dominio <em>treyresearch.com</em> (el dominio en la nube).</span><span class="sxs-lookup"><span data-stu-id="e3664-218">From the jump-box, connect to the first VM in the <em>treyresearch.com</em> domain (the domain in the cloud).</span></span> <span data-ttu-id="e3664-219">Esta máquina virtual tiene la dirección IP 10.0.4.4.</span><span class="sxs-lookup"><span data-stu-id="e3664-219">This VM has the IP address 10.0.4.4.</span></span> <span data-ttu-id="e3664-220">El nombre de usuario es <em>treyresearch\testuser</em> y la contraseña <em>AweS0me@PW</em>.</span><span class="sxs-lookup"><span data-stu-id="e3664-220">The username is <em>treyresearch\testuser</em> with password <em>AweS0me@PW</em>.</span></span>

8. <span data-ttu-id="e3664-221">Descargue el script [outgoing-trust.ps1][outgoing-trust] y ejecútelo para crear la confianza saliente desde el dominio *treyresearch.com*.</span><span class="sxs-lookup"><span data-stu-id="e3664-221">Download the [outgoing-trust.ps1][outgoing-trust] script and run it to create the incoming trust from the *treyresearch.com* domain.</span></span> <span data-ttu-id="e3664-222">Si va a usar sus propias máquinas locales, edite primero el script.</span><span class="sxs-lookup"><span data-stu-id="e3664-222">If you are using your own on-premises machines, then edit the script first.</span></span> <span data-ttu-id="e3664-223">Establezca la variable `$TrustedDomainName` en el nombre del dominio local y especifique las direcciones IP de los servidores de Active Directory DS para este dominio en la variable `$TrustedDomainDnsIpAddresses`.</span><span class="sxs-lookup"><span data-stu-id="e3664-223">Set the `$TrustedDomainName` variable to the name of your on-premises domain, and specify the IP addresses of the Active Directory DS servers for this domain in the `$TrustedDomainDnsIpAddresses` variable.</span></span>

9. <span data-ttu-id="e3664-224">Espere unos minutos a que finalicen los pasos anteriores y luego conéctese a una máquina virtual local y siga los pasos descritos en el artículo [Comprobación de una confianza][verify-a-trust] para determinar si la relación de confianza entre los dominios *contoso.com* y *treyresearch.com* está configurada correctamente.</span><span class="sxs-lookup"><span data-stu-id="e3664-224">Wait a few minutes for the previous steps to complete, then connect to an on-premises VM and perform the steps outlined in the article [Verify a Trust][verify-a-trust] to determine whether the trust relationship between the *contoso.com* and *treyresearch.com* domains is correctly configured.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e3664-225">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="e3664-225">Next steps</span></span>

* <span data-ttu-id="e3664-226">Conozca los procedimientos recomendados para [extender el dominio de AD DS local a Azure][adds-extend-domain]</span><span class="sxs-lookup"><span data-stu-id="e3664-226">Learn the best practices for [extending your on-premises AD DS domain to Azure][adds-extend-domain]</span></span>
* <span data-ttu-id="e3664-227">Conozca los procedimientos recomendados para [crear una infraestructura de AD FS][adfs] en Azure.</span><span class="sxs-lookup"><span data-stu-id="e3664-227">Learn the best practices for [creating an AD FS infrastructure][adfs] in Azure.</span></span>

<!-- links -->
[adds-extend-domain]: adds-extend-domain.md
[adfs]: adfs.md

[implementing-a-secure-hybrid-network-architecture]: ../dmz/secure-vnet-hybrid.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ../dmz/secure-vnet-dmz.md

[running-VMs-for-an-N-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[ad-azure-guidelines]: https://msdn.microsoft.com/library/azure/jj156090.aspx
[azure-expressroute]: https://azure.microsoft.com/documentation/articles/expressroute-introduction/
[azure-vpn-gateway]: https://azure.microsoft.com/documentation/articles/vpn-gateway-about-vpngateways/
[considerations]: ./considerations.md
[creating-external-trusts]: https://technet.microsoft.com/library/cc816837(v=ws.10).aspx
[creating-forest-trusts]: https://technet.microsoft.com/library/cc816810(v=ws.10).aspx
[github]: https://github.com/mspnp/reference-architectures/tree/master/identity/adds-forest
[incoming-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/incoming-trust.ps1
[microsoft_systems_center]: https://www.microsoft.com/server-cloud/products/system-center-2016/
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[solution-script]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/Deploy-ReferenceArchitecture.ps1
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[outgoing-trust]: https://raw.githubusercontent.com/mspnp/reference-architectures/master/identity/adds-forest/extensions/outgoing-trust.ps1
[verify-a-trust]: https://technet.microsoft.com/library/cc753821.aspx
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
[0]: ./images/adds-forest.png "Protección de la arquitectura de red híbrida con dominios independientes de Active Directory"