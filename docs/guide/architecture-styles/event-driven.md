---
title: Estilo de arquitectura basada en eventos
description: Describe las ventajas, las dificultades y los procedimientos recomendados para las arquitecturas IoT y basadas en eventos en Azure.
author: MikeWasson
ms.openlocfilehash: 3289bf784b02d62e3d0c1a29b4839c9be3501134
ms.sourcegitcommit: 3d9ee03e2dda23753661a80c7106d1789f5223bb
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/23/2018
ms.locfileid: "29478330"
---
# <a name="event-driven-architecture-style"></a><span data-ttu-id="08d9e-103">Estilo de arquitectura basada en eventos</span><span class="sxs-lookup"><span data-stu-id="08d9e-103">Event-driven architecture style</span></span>

<span data-ttu-id="08d9e-104">Una arquitectura basada en eventos consta de **productores de eventos** que generan un flujo de eventos, y **consumidores de eventos** que escuchan los eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-104">An event-driven architecture consists of **event producers** that generate a stream of events, and **event consumers** that listen for the events.</span></span> 

![](./images/event-driven.svg)

<span data-ttu-id="08d9e-105">Los eventos se entregan casi en tiempo real, de modo que los consumidores pueden responder inmediatamente a los eventos cuando se producen.</span><span class="sxs-lookup"><span data-stu-id="08d9e-105">Events are delivered in near real time, so consumers can respond immediately to events as they occur.</span></span> <span data-ttu-id="08d9e-106">Los productores se desconectan de los consumidores &mdash; un productor no sabe que los consumidores están escuchando.</span><span class="sxs-lookup"><span data-stu-id="08d9e-106">Producers are decoupled from consumers &mdash; a producer doesn't know which consumers are listening.</span></span> <span data-ttu-id="08d9e-107">Los consumidores también se desconectan entre sí, y cada consumidor ve todos los eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-107">Consumers are also decoupled from each other, and every consumer sees all of the events.</span></span> <span data-ttu-id="08d9e-108">Esto difiere de un patrón [Competing Consumers][competing-consumers], donde los consumidores extraen los mensajes de una cola y los mensajes solo se procesan una vez (suponiendo que no haya errores).</span><span class="sxs-lookup"><span data-stu-id="08d9e-108">This differs from a [Competing Consumers][competing-consumers] pattern, where consumers pull messages from a queue and a message is processed just once (assuming no errors).</span></span> <span data-ttu-id="08d9e-109">En algunos sistemas, como IoT, los eventos se deben ingerir en volúmenes muy altos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-109">In some systems, such as IoT, events must be ingested at very high volumes.</span></span>

<span data-ttu-id="08d9e-110">Una arquitectura basada en eventos puede usar un modelo pub/sub o un modelo de flujo de eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-110">An event driven architecture can use a pub/sub model or an event stream model.</span></span> 

- <span data-ttu-id="08d9e-111">**Pub/sub**: la infraestructura de mensajería mantiene un seguimiento de las suscripciones.</span><span class="sxs-lookup"><span data-stu-id="08d9e-111">**Pub/sub**: The messaging infrastructure keeps track of subscriptions.</span></span> <span data-ttu-id="08d9e-112">Cuando se publica un evento, se envía el evento a cada suscriptor.</span><span class="sxs-lookup"><span data-stu-id="08d9e-112">When an event is published, it sends the event to each subscriber.</span></span> <span data-ttu-id="08d9e-113">Después de que se recibe un evento, no se puede reproducir, y los nuevos suscriptores no ven el evento.</span><span class="sxs-lookup"><span data-stu-id="08d9e-113">After an event is received, it cannot be replayed, and new subscribers do not see the event.</span></span> 

- <span data-ttu-id="08d9e-114">**Flujo de eventos**: los eventos se escriben en un registro.</span><span class="sxs-lookup"><span data-stu-id="08d9e-114">**Event streaming**: Events are written to a log.</span></span> <span data-ttu-id="08d9e-115">Los eventos siguen un orden estricto (dentro de una partición) y son duraderos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-115">Events are strictly ordered (within a partition) and durable.</span></span> <span data-ttu-id="08d9e-116">Los clientes no se suscriben al flujo, sino que un cliente puede leer desde cualquiera de sus partes.</span><span class="sxs-lookup"><span data-stu-id="08d9e-116">Clients don't subscribe to the stream, instead a client can read from any part of the stream.</span></span> <span data-ttu-id="08d9e-117">El cliente es responsable de avanzar su posición en el flujo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-117">The client is responsible for advancing its position in the stream.</span></span> <span data-ttu-id="08d9e-118">Esto significa que un cliente puede unirse en cualquier momento y puede reproducir los eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-118">That means a client can join at any time, and can replay events.</span></span>

<span data-ttu-id="08d9e-119">En el lado del consumidor, hay algunas variaciones comunes:</span><span class="sxs-lookup"><span data-stu-id="08d9e-119">On the consumer side, there are some common variations:</span></span>

- <span data-ttu-id="08d9e-120">**Procesamiento sencillo de eventos**.</span><span class="sxs-lookup"><span data-stu-id="08d9e-120">**Simple event processing**.</span></span> <span data-ttu-id="08d9e-121">Un evento desencadena inmediatamente una acción en el consumidor.</span><span class="sxs-lookup"><span data-stu-id="08d9e-121">An event immediately triggers an action in the consumer.</span></span> <span data-ttu-id="08d9e-122">Por ejemplo, podría usar Azure Functions con un desencadenador de Service Bus para que una función se ejecute cada vez que se publica un mensaje en un tema de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="08d9e-122">For example, you could use Azure Functions with a Service Bus trigger, so that a function executes whenever a message is published to a Service Bus topic.</span></span>

- <span data-ttu-id="08d9e-123">**Procesamiento de eventos complejos**.</span><span class="sxs-lookup"><span data-stu-id="08d9e-123">**Complex event processing**.</span></span> <span data-ttu-id="08d9e-124">Un consumidor procesa una serie de eventos, en busca de patrones en los datos de eventos, mediante una tecnología como Azure Stream Analytics o Apache Storm.</span><span class="sxs-lookup"><span data-stu-id="08d9e-124">A consumer processes a series of events, looking for patterns in the event data, using a technology such as Azure Stream Analytics or Apache Storm.</span></span> <span data-ttu-id="08d9e-125">Por ejemplo, podría agregar las lecturas de un dispositivo insertado durante una ventana de tiempo y generar una notificación si la media móvil supera un umbral determinado.</span><span class="sxs-lookup"><span data-stu-id="08d9e-125">For example, you could aggregate readings from an embedded device over a time window, and generate a notification if the moving average crosses a certain threshold.</span></span> 

- <span data-ttu-id="08d9e-126">**Procesamiento de flujo de eventos**.</span><span class="sxs-lookup"><span data-stu-id="08d9e-126">**Event stream processing**.</span></span> <span data-ttu-id="08d9e-127">Use una plataforma de flujo de datos, como Azure IoT Hub o Apache Kafka, como canalización para ingerir eventos y suministrarlos a procesadores de flujo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-127">Use a data streaming platform, such as Azure IoT Hub or Apache Kafka, as a pipeline to ingest events and feed them to stream processors.</span></span> <span data-ttu-id="08d9e-128">Los procesadores de flujos sirven para procesar o transformar el flujo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-128">The stream processors act to process or transform the stream.</span></span> <span data-ttu-id="08d9e-129">Puede haber varios procesadores de flujo para diferentes subsistemas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="08d9e-129">There may be multiple stream processors for different subsystems of the application.</span></span> <span data-ttu-id="08d9e-130">Este enfoque es una buena opción para las cargas de trabajo de IoT.</span><span class="sxs-lookup"><span data-stu-id="08d9e-130">This approach is a good fit for IoT workloads.</span></span>

<span data-ttu-id="08d9e-131">El origen de los eventos puede ser externo con respecto al sistema, como dispositivos físicos en una solución de IoT.</span><span class="sxs-lookup"><span data-stu-id="08d9e-131">The source of the events may be external to the system, such as physical devices in an IoT solution.</span></span> <span data-ttu-id="08d9e-132">En ese caso, el sistema debe ser capaz de ingerir los datos según el volumen y el rendimiento que requiere el origen de datos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-132">In that case, the system must be able to ingest the data at the volume and throughput that is required by the data source.</span></span>

<span data-ttu-id="08d9e-133">En el diagrama lógico anterior, se muestra cada tipo de consumidor como un solo cuadro.</span><span class="sxs-lookup"><span data-stu-id="08d9e-133">In the logical diagram above, each type of consumer is shown as a single box.</span></span> <span data-ttu-id="08d9e-134">En la práctica, es habitual tener varias instancias de un consumidor para evitar hacer que el consumidor se convierta en un único punto de error en el sistema.</span><span class="sxs-lookup"><span data-stu-id="08d9e-134">In practice, it's common to have multiple instances of a consumer, to avoid having the consumer become a single point of failure in system.</span></span> <span data-ttu-id="08d9e-135">También podrían ser necesarias varias instancias para administrar el volumen y la frecuencia de los eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-135">Multiple instances might also be necessary to handle the volume and frequency of events.</span></span> <span data-ttu-id="08d9e-136">Además, un único consumidor podría procesar eventos en varios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-136">Also, a single consumer might process events on multiple threads.</span></span> <span data-ttu-id="08d9e-137">Esto puede crear dificultades si los eventos se deben procesar en orden o requieren la semántica exactly-once.</span><span class="sxs-lookup"><span data-stu-id="08d9e-137">This can create challenges if events must be processed in order, or require exactly-once semantics.</span></span> <span data-ttu-id="08d9e-138">Consulte [Minimizar la coordinación][minimize-coordination].</span><span class="sxs-lookup"><span data-stu-id="08d9e-138">See [Minimize Coordination][minimize-coordination].</span></span> 

## <a name="when-to-use-this-architecture"></a><span data-ttu-id="08d9e-139">Cuándo utilizar esta arquitectura</span><span class="sxs-lookup"><span data-stu-id="08d9e-139">When to use this architecture</span></span>

- <span data-ttu-id="08d9e-140">Varios subsistemas deben procesar los mismos eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-140">Multiple subsystems must process the same events.</span></span> 
- <span data-ttu-id="08d9e-141">Procesamiento en tiempo real con retardo mínimo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-141">Real-time processing with minimum time lag.</span></span>
- <span data-ttu-id="08d9e-142">Procesamiento de eventos complejos, como coincidencia de patrones o agregación durante ventanas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-142">Complex event processing, such as pattern matching or aggregation over time windows.</span></span>
- <span data-ttu-id="08d9e-143">Gran volumen y alta velocidad de datos, como IoT.</span><span class="sxs-lookup"><span data-stu-id="08d9e-143">High volume and high velocity of data, such as IoT.</span></span>

## <a name="benefits"></a><span data-ttu-id="08d9e-144">Ventajas</span><span class="sxs-lookup"><span data-stu-id="08d9e-144">Benefits</span></span>

- <span data-ttu-id="08d9e-145">Se desvinculan productores y consumidores.</span><span class="sxs-lookup"><span data-stu-id="08d9e-145">Producers and consumers are decoupled.</span></span>
- <span data-ttu-id="08d9e-146">Ninguna integración punto a punto.</span><span class="sxs-lookup"><span data-stu-id="08d9e-146">No point-to point-integrations.</span></span> <span data-ttu-id="08d9e-147">Es fácil agregar nuevos consumidores al sistema.</span><span class="sxs-lookup"><span data-stu-id="08d9e-147">It's easy to add new consumers to the system.</span></span>
- <span data-ttu-id="08d9e-148">Los consumidores pueden responder a eventos inmediatamente a medida que llegan.</span><span class="sxs-lookup"><span data-stu-id="08d9e-148">Consumers can respond to events immediately as they arrive.</span></span> 
- <span data-ttu-id="08d9e-149">Muy escalable y distribuida.</span><span class="sxs-lookup"><span data-stu-id="08d9e-149">Highly scalable and distributed.</span></span> 
- <span data-ttu-id="08d9e-150">Los subsistemas tienen vistas independientes del flujo de eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-150">Subsystems have independent views of the event stream.</span></span>

## <a name="challenges"></a><span data-ttu-id="08d9e-151">Desafíos</span><span class="sxs-lookup"><span data-stu-id="08d9e-151">Challenges</span></span>

- <span data-ttu-id="08d9e-152">Entrega garantizada.</span><span class="sxs-lookup"><span data-stu-id="08d9e-152">Guaranteed delivery.</span></span> <span data-ttu-id="08d9e-153">En algunos sistemas, especialmente en escenarios de IoT, es fundamental garantizar la entrega de los eventos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-153">In some systems, especially in IoT scenarios, it's crucial to guarantee that events are delivered.</span></span>
- <span data-ttu-id="08d9e-154">Procesamiento de eventos en orden o exactamente una vez.</span><span class="sxs-lookup"><span data-stu-id="08d9e-154">Processing events in order or exactly once.</span></span> <span data-ttu-id="08d9e-155">Cada tipo de consumidor normalmente se ejecuta en varias instancias, a fin de conseguir resistencia y escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="08d9e-155">Each consumer type typically runs in multiple instances, for resiliency and scalability.</span></span> <span data-ttu-id="08d9e-156">Esto puede suponer un desafío si se deben procesar los eventos en orden (dentro de un tipo de consumidor), o si la lógica de procesamiento no es idempotente.</span><span class="sxs-lookup"><span data-stu-id="08d9e-156">This can create a challenge if the events must be processed in order (within a consumer type), or if the processing logic is not idempotent.</span></span>

## <a name="iot-architecture"></a><span data-ttu-id="08d9e-157">Arquitectura de IoT</span><span class="sxs-lookup"><span data-stu-id="08d9e-157">IoT architecture</span></span>

<span data-ttu-id="08d9e-158">Las arquitecturas basadas en eventos son básicas para las soluciones de IoT.</span><span class="sxs-lookup"><span data-stu-id="08d9e-158">Event-driven architectures are central to IoT solutions.</span></span> <span data-ttu-id="08d9e-159">En el siguiente diagrama se muestra una posible arquitectura lógica de IoT.</span><span class="sxs-lookup"><span data-stu-id="08d9e-159">The following diagram shows a possible logical architecture for IoT.</span></span> <span data-ttu-id="08d9e-160">En él se resaltan los componentes del flujo de eventos de la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="08d9e-160">The diagram emphasizes the event-streaming components of the architecture.</span></span>

![](./images/iot.png)

<span data-ttu-id="08d9e-161">La **puerta de enlace de nube** ingiere eventos de dispositivo en el límite de nube, mediante un sistema de mensajería confiable y de baja latencia.</span><span class="sxs-lookup"><span data-stu-id="08d9e-161">The **cloud gateway** ingests device events at the cloud boundary, using a reliable, low latency messaging system.</span></span>

<span data-ttu-id="08d9e-162">Los dispositivos pueden enviar eventos directamente a la puerta de enlace de nube, o a través de una **puerta de enlace de campo**.</span><span class="sxs-lookup"><span data-stu-id="08d9e-162">Devices might send events directly to the cloud gateway, or through a **field gateway**.</span></span> <span data-ttu-id="08d9e-163">Una puerta de enlace de campo es un dispositivo o software especializado, que normalmente se coloca con los dispositivos, que recibe eventos y los reenvía a la puerta de enlace de nube.</span><span class="sxs-lookup"><span data-stu-id="08d9e-163">A field gateway is a specialized device or software, usually colocated with the devices, that receives events and forwards them to the cloud gateway.</span></span> <span data-ttu-id="08d9e-164">La puerta de enlace de campo también puede procesar previamente los eventos de dispositivo sin formato y realizar funciones como filtrado, agregación o transformación de protocolo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-164">The field gateway might also preprocess the raw device events, performing functions such as filtering, aggregation, or protocol transformation.</span></span>

<span data-ttu-id="08d9e-165">Después de la ingesta, los eventos pasan por uno o varios **procesadores de flujo** que pueden enrutar los datos (por ejemplo, al almacenamiento) o realizar análisis u otras tareas de procesamiento.</span><span class="sxs-lookup"><span data-stu-id="08d9e-165">After ingestion, events go through one or more **stream processors** that can route the data (for example, to storage) or perform analytics and other processing.</span></span>

<span data-ttu-id="08d9e-166">Estos son algunos tipos comunes de procesamiento.</span><span class="sxs-lookup"><span data-stu-id="08d9e-166">The following are some common types of processing.</span></span> <span data-ttu-id="08d9e-167">(Ciertamente, esta lista no es exhaustiva).</span><span class="sxs-lookup"><span data-stu-id="08d9e-167">(This list is certainly not exhaustive.)</span></span>

- <span data-ttu-id="08d9e-168">Escribir datos de eventos en almacenamiento en frío, para archivado o análisis por lotes.</span><span class="sxs-lookup"><span data-stu-id="08d9e-168">Writing event data to cold storage, for archiving or batch analytics.</span></span>

- <span data-ttu-id="08d9e-169">Análisis de ruta de acceso activa, que analiza el flujo de eventos (casi) en tiempo real para detectar anomalías, reconocer patrones durante ventanas de tiempo consecutivas o desencadenar alertas cuando se produce una condición especifica en el flujo.</span><span class="sxs-lookup"><span data-stu-id="08d9e-169">Hot path analytics, analyzing the event stream in (near) real time, to detect anomalies, recognize patterns over rolling time windows, or trigger alerts when a specific condition occurs in the stream.</span></span> 

- <span data-ttu-id="08d9e-170">Administrar tipos especiales de mensajes que no son de telemetría de dispositivos, tales como notificaciones y alarmas.</span><span class="sxs-lookup"><span data-stu-id="08d9e-170">Handling special types of non-telemetry messages from devices, such as notifications and alarms.</span></span> 

- <span data-ttu-id="08d9e-171">Machine Learning</span><span class="sxs-lookup"><span data-stu-id="08d9e-171">Machine learning.</span></span>

<span data-ttu-id="08d9e-172">Los cuadros que aparecen en gris sombreado muestran los componentes de un sistema IoT que no están directamente relacionados con el flujo de eventos, pero se incluyen aquí para ofrecer una visión completa.</span><span class="sxs-lookup"><span data-stu-id="08d9e-172">The boxes that are shaded gray show components of an IoT system that are not directly related to event streaming, but are included here for completeness.</span></span>

- <span data-ttu-id="08d9e-173">El **registro de dispositivos** es una base de datos de los dispositivos aprovisionados, incluidos los identificadores de dispositivo y habitualmente los metadatos de dispositivos, como la ubicación.</span><span class="sxs-lookup"><span data-stu-id="08d9e-173">The **device registry** is a database of the provisioned devices, including the device IDs and usually device metadata, such as location.</span></span>

- <span data-ttu-id="08d9e-174">La **API de aprovisionamiento** es una interfaz externa común para el aprovisionamiento y el registro de nuevos dispositivos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-174">The **provisioning API** is a common external interface for provisioning and registering new devices.</span></span>

- <span data-ttu-id="08d9e-175">Algunas soluciones IoT permiten el envío de **mensajes de comando y control** a los dispositivos.</span><span class="sxs-lookup"><span data-stu-id="08d9e-175">Some IoT solutions allow **command and control messages** to be sent to devices.</span></span>

> <span data-ttu-id="08d9e-176">En esta sección se ha presentado una vista de muy alto nivel de IoT y hay muchos matices y desafíos que se deben tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="08d9e-176">This section has presented a very high-level view of IoT, and there are many subtleties and challenges to consider.</span></span> <span data-ttu-id="08d9e-177">Para más información y obtener un análisis de una arquitectura de referencia, consulte [Microsoft Azure IoT Reference Architecture][iot-ref-arch] (Arquitectura de referencia de Microsoft Azure IoT) (descarga PDF).</span><span class="sxs-lookup"><span data-stu-id="08d9e-177">For a more detailed reference architecture and discussion, see the [Microsoft Azure IoT Reference Architecture][iot-ref-arch] (PDF download).</span></span>

 <!-- links -->

[competing-consumers]: ../../patterns/competing-consumers.md
[iot-ref-arch]: https://azure.microsoft.com/updates/microsoft-azure-iot-reference-architecture-available/
[minimize-coordination]: ../design-principles/minimize-coordination.md


