---
title: 'Guía técnica: recuperación ante errores locales en Azure'
description: Artículo para entender y diseñar aplicaciones resistentes, con alta disponibilidad y con tolerancia a errores, así como para planear la recuperación ante desastres centrada en errores locales dentro de Azure.
author: adamglick
ms.date: 08/18/2016
ms.openlocfilehash: 5fc929bd1affe3dd6616f908bae0e7d2fefb89d5
ms.sourcegitcommit: e67b751f230792bba917754d67789a20810dc76b
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 04/06/2018
---
[!INCLUDE [header](../_includes/header.md)]

# <a name="azure-resiliency-technical-guidance-recovery-from-local-failures-in-azure"></a><span data-ttu-id="4204d-103">Guía técnica sobre resistencia en Azure: recuperación ante errores locales en Azure</span><span class="sxs-lookup"><span data-stu-id="4204d-103">Azure resiliency technical guidance: Recovery from local failures in Azure</span></span>

<span data-ttu-id="4204d-104">Hay dos amenazas principales para la disponibilidad de las aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="4204d-104">There are two primary threats to application availability:</span></span>

* <span data-ttu-id="4204d-105">El error de los dispositivos, como las unidades de disco y los servidores</span><span class="sxs-lookup"><span data-stu-id="4204d-105">The failure of devices, such as drives and servers</span></span>
* <span data-ttu-id="4204d-106">El agotamiento de los recursos críticos, como el proceso en condiciones de carga máxima</span><span class="sxs-lookup"><span data-stu-id="4204d-106">The exhaustion of critical resources, such as compute under peak load conditions</span></span>

<span data-ttu-id="4204d-107">Azure ofrece una combinación de administración de recursos, elasticidad, equilibrio de carga y creación de particiones que habilita la alta disponibilidad en estas circunstancias.</span><span class="sxs-lookup"><span data-stu-id="4204d-107">Azure provides a combination of resource management, elasticity, load balancing, and partitioning to enable high availability under these circumstances.</span></span> <span data-ttu-id="4204d-108">Algunas de estas características se realizan automáticamente para todos los servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-108">Some of these features are performed automatically for all Azure services.</span></span> <span data-ttu-id="4204d-109">Sin embargo, en algunos casos, el desarrollador de aplicaciones debe realizar un trabajo adicional para beneficiarse de ellas.</span><span class="sxs-lookup"><span data-stu-id="4204d-109">However, in some cases, the application developer must do some additional work to benefit from them.</span></span>

## <a name="cloud-services"></a><span data-ttu-id="4204d-110">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="4204d-110">Cloud Services</span></span>
<span data-ttu-id="4204d-111">Azure Cloud Services consta de varias colecciones de uno o varios roles de trabajo o web.</span><span class="sxs-lookup"><span data-stu-id="4204d-111">Azure Cloud Services consists of collections of one or more web or worker roles.</span></span> <span data-ttu-id="4204d-112">Se pueden ejecutar una o varias instancias de un rol simultáneamente.</span><span class="sxs-lookup"><span data-stu-id="4204d-112">One or more instances of a role can run concurrently.</span></span> <span data-ttu-id="4204d-113">La configuración determina el número de instancias.</span><span class="sxs-lookup"><span data-stu-id="4204d-113">The configuration determines the number of instances.</span></span> <span data-ttu-id="4204d-114">Las instancias de rol se supervisan y administran mediante un componente denominado controlador de tejido.</span><span class="sxs-lookup"><span data-stu-id="4204d-114">Role instances are monitored and managed through a component called the fabric controller.</span></span> <span data-ttu-id="4204d-115">El controlador de tejido detecta y responde automáticamente ante los errores de software y de hardware.</span><span class="sxs-lookup"><span data-stu-id="4204d-115">The fabric controller detects and responds to both software and hardware failures automatically.</span></span>

<span data-ttu-id="4204d-116">Todas las instancias de rol se ejecutan en su propia máquina virtual (VM) y se comunica con su controlador de tejido a través de un agente invitado.</span><span class="sxs-lookup"><span data-stu-id="4204d-116">Every role instance runs in its own virtual machine (VM) and communicates with its fabric controller through a guest agent.</span></span> <span data-ttu-id="4204d-117">El agente invitado recopila métricas de nodos y de recursos, entre las que se incluye el uso, el estado, los registros, el uso de recursos, las excepciones y las condiciones de error de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="4204d-117">The guest agent collects resource and node metrics, including VM usage, status, logs, resource usage, exceptions, and failure conditions.</span></span> <span data-ttu-id="4204d-118">El controlador de tejido consulta al agente invitado a intervalos configurables y reinicia la máquina virtual si el agente invitado no responde.</span><span class="sxs-lookup"><span data-stu-id="4204d-118">The fabric controller queries the guest agent at configurable intervals, and it restarts the VM if the guest agent fails to respond.</span></span> <span data-ttu-id="4204d-119">En caso de error de hardware, el controlador de tejido asociado mueve todas las instancias de rol afectadas a un nuevo nodo de hardware y vuelve a configurar la red para enrutar el tráfico que hay allí.</span><span class="sxs-lookup"><span data-stu-id="4204d-119">In the event of hardware failure, the associated fabric controller moves all affected role instances to a new hardware node and reconfigures the network to route traffic there.</span></span>

<span data-ttu-id="4204d-120">Para beneficiarse de estas características, los desarrolladores deben garantizar que todos los roles de servicio impiden almacenar el estado en las instancias de rol.</span><span class="sxs-lookup"><span data-stu-id="4204d-120">To benefit from these features, developers should ensure that all service roles avoid storing state on the role instances.</span></span> <span data-ttu-id="4204d-121">En su lugar, se debe acceder a todos los datos persistentes desde un almacenamiento duradero, como Azure Storage o Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="4204d-121">Instead, all persistent data should be accessed from durable storage, such as Azure Storage or Azure SQL Database.</span></span> <span data-ttu-id="4204d-122">Esto permite que cualquier rol controle las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="4204d-122">This allows any roles to handle requests.</span></span> <span data-ttu-id="4204d-123">También significa que las instancias de rol pueden dejar de funcionar en un momento dado sin que ello genere incoherencias en el estado transitorio o persistente del servicio.</span><span class="sxs-lookup"><span data-stu-id="4204d-123">It also means that role instances can go down at any time without creating inconsistencies in the transient or persistent state of the service.</span></span>

<span data-ttu-id="4204d-124">El requisito para almacenar el estado externamente en los roles tiene varias implicaciones.</span><span class="sxs-lookup"><span data-stu-id="4204d-124">The requirement to store state externally to the roles has several implications.</span></span> <span data-ttu-id="4204d-125">Por ejemplo, implica que todos los cambios relacionados con una tabla de Azure Storage deben realizarse, si es posible, en una única transacción de grupos de entidades.</span><span class="sxs-lookup"><span data-stu-id="4204d-125">It implies, for example, that all related changes to an Azure Storage table should be changed in a single entity-group transaction, if possible.</span></span> <span data-ttu-id="4204d-126">Por supuesto, no siempre es posible realizar todos los cambios en una sola transacción.</span><span class="sxs-lookup"><span data-stu-id="4204d-126">Of course, it isn't always possible to make all changes in a single transaction.</span></span> <span data-ttu-id="4204d-127">Debe tener especial cuidado de asegurarse de que los errores de instancias de rol no causan problemas cuando interrumpan operaciones de ejecución prolongada que abarcan dos o más actualizaciones en el estado persistente del servicio.</span><span class="sxs-lookup"><span data-stu-id="4204d-127">You must take special care to ensure that role instance failures do not cause problems when they interrupt long-running operations that span two or more updates to the persistent state of the service.</span></span> <span data-ttu-id="4204d-128">Si otro rol vuelve a intentar esta operación, debe anticiparse y controlar aquella situación en la que el trabajo se completó parcialmente.</span><span class="sxs-lookup"><span data-stu-id="4204d-128">If another role attempts to retry such an operation, it should anticipate and handle the case where the work was partially completed.</span></span>

<span data-ttu-id="4204d-129">Por ejemplo, considere un servicio que crea particiones de datos en varios almacenes.</span><span class="sxs-lookup"><span data-stu-id="4204d-129">For example, consider a service that partitions data across multiple stores.</span></span> <span data-ttu-id="4204d-130">Si un rol de trabajo deja de funcionar mientras se reubica una partición, es posible que dicha reubicación no finalice.</span><span class="sxs-lookup"><span data-stu-id="4204d-130">If a worker role goes down while it's relocating a shard, the relocation of the shard might not finish.</span></span> <span data-ttu-id="4204d-131">O bien, la reubicación se pueden repetir desde su concepción por parte de otro un rol de trabajo, lo que puede causar datos huérfanos o daños en los datos.</span><span class="sxs-lookup"><span data-stu-id="4204d-131">Or the relocation might be repeated from its inception by a different worker role, potentially causing orphaned data or data corruption.</span></span> <span data-ttu-id="4204d-132">Para evitar problemas, las operaciones de ejecución prolongada deben ser:</span><span class="sxs-lookup"><span data-stu-id="4204d-132">To prevent problems, long-running operations must be one or both of the following:</span></span>

* <span data-ttu-id="4204d-133">*Idempotente*: repetibles sin efectos secundarios.</span><span class="sxs-lookup"><span data-stu-id="4204d-133">*Idempotent*: Repeatable without side effects.</span></span> <span data-ttu-id="4204d-134">Para ser idempotente, una operación de ejecución prolongada debe tener el mismo efecto, independientemente de cuántas veces se ejecuta, incluso si la ejecución se interrumpe.</span><span class="sxs-lookup"><span data-stu-id="4204d-134">To be idempotent, a long-running operation should have the same effect no matter how many times it's executed, even when it's interrupted during execution.</span></span>
* <span data-ttu-id="4204d-135">*Reiniciable incrementalmente*: capaces de continuar desde el último punto de error.</span><span class="sxs-lookup"><span data-stu-id="4204d-135">*Incrementally restartable*: Able to continue from the most recent point of failure.</span></span> <span data-ttu-id="4204d-136">Para ser reiniciable incrementalmente, una operación de ejecución prolongada debe constar de una secuencia de operaciones atómicas menores.</span><span class="sxs-lookup"><span data-stu-id="4204d-136">To be incrementally restartable, a long-running operation should consist of a sequence of smaller atomic operations.</span></span> <span data-ttu-id="4204d-137">También debe registrar su progreso en un almacenamiento duradero, con el fin de que cada invocación posterior comience donde se detuvo su predecesora.</span><span class="sxs-lookup"><span data-stu-id="4204d-137">It should also record its progress in durable storage, so that each subsequent invocation picks up where its predecessor stopped.</span></span>

<span data-ttu-id="4204d-138">Por último, todas las operaciones de ejecución prolongada se deben invocar varias veces hasta que se realicen correctamente.</span><span class="sxs-lookup"><span data-stu-id="4204d-138">Finally, all long-running operations should be invoked repeatedly until they succeed.</span></span> <span data-ttu-id="4204d-139">Por ejemplo, un rol de trabajo puede colocar una operación de aprovisionamiento en una cola de Azure y, luego, quitarla de la cola solo cuando la operación se haya ejecutado correctamente.</span><span class="sxs-lookup"><span data-stu-id="4204d-139">For example, a provisioning operation might be placed in an Azure queue, and then removed from the queue by a worker role only when it succeeds.</span></span> <span data-ttu-id="4204d-140">Es posible que la recolección de elementos no utilizados sea necesaria para limpiar los datos que interrumpieron la creación de operaciones.</span><span class="sxs-lookup"><span data-stu-id="4204d-140">Garbage collection might be necessary to clean up data that interrupted operations create.</span></span>

### <a name="elasticity"></a><span data-ttu-id="4204d-141">Elasticidad</span><span class="sxs-lookup"><span data-stu-id="4204d-141">Elasticity</span></span>
<span data-ttu-id="4204d-142">El número inicial de instancias que se ejecutan para cada rol se determina en la configuración del mismo.</span><span class="sxs-lookup"><span data-stu-id="4204d-142">The initial number of instances running for each role is determined in each role’s configuration.</span></span> <span data-ttu-id="4204d-143">Los administradores deben configurar inicialmente cada uno de los roles para que se ejecute con dos o más instancias según la carga esperada.</span><span class="sxs-lookup"><span data-stu-id="4204d-143">Administrators should initially configure each role to run with two or more instances based on expected load.</span></span> <span data-ttu-id="4204d-144">Pero las instancias de rol pueden escalarse fácilmente de forma vertical u horizontal a medida que cambian los patrones de uso.</span><span class="sxs-lookup"><span data-stu-id="4204d-144">But you can easily scale role instances up or down as usage patterns change.</span></span> <span data-ttu-id="4204d-145">Esto se puede hacer manualmente en el Portal de Azure, o bien se puede automatizar el proceso con Windows PowerShell, Service Management API o herramientas de terceros.</span><span class="sxs-lookup"><span data-stu-id="4204d-145">You can do this manually in the Azure portal, or you can automate the process by using Windows PowerShell, the Service Management API, or third-party tools.</span></span> <span data-ttu-id="4204d-146">Para más información, consulte [Cómo escalar automáticamente un servicio en la nube](/azure/cloud-services/cloud-services-how-to-scale/).</span><span class="sxs-lookup"><span data-stu-id="4204d-146">For more information, see [How to autoscale an application](/azure/cloud-services/cloud-services-how-to-scale/).</span></span>

### <a name="partitioning"></a><span data-ttu-id="4204d-147">Creación de particiones</span><span class="sxs-lookup"><span data-stu-id="4204d-147">Partitioning</span></span>
<span data-ttu-id="4204d-148">El controlador de tejido de Azure usa dos tipos de particiones:</span><span class="sxs-lookup"><span data-stu-id="4204d-148">The Azure fabric controller uses two types of partitions:</span></span>

* <span data-ttu-id="4204d-149">Se usa un *dominio de actualización* para actualizar las instancias de rol de un servicio en grupos.</span><span class="sxs-lookup"><span data-stu-id="4204d-149">An *update domain* is used to upgrade a service’s role instances in groups.</span></span> <span data-ttu-id="4204d-150">Azure implementa las instancias de servicio en varios dominios de actualización.</span><span class="sxs-lookup"><span data-stu-id="4204d-150">Azure deploys service instances into multiple update domains.</span></span> <span data-ttu-id="4204d-151">Para realizar una actualización en la ubicación, el controlador de tejido desactiva todas las instancias de un dominio de actualización, las actualiza y, después, las reinicia antes de pasar al siguiente dominio de actualización.</span><span class="sxs-lookup"><span data-stu-id="4204d-151">For an in-place update, the fabric controller brings down all the instances in one update domain, updates them, and then restarts them before moving to the next update domain.</span></span> <span data-ttu-id="4204d-152">Este método evita que todo el servicio se quede sin disponibilidad durante el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="4204d-152">This approach prevents the entire service from being unavailable during the update process.</span></span>
* <span data-ttu-id="4204d-153">Un *dominio de error* define los potenciales puntos de error de hardware o de la red.</span><span class="sxs-lookup"><span data-stu-id="4204d-153">A *fault domain* defines potential points of hardware or network failure.</span></span> <span data-ttu-id="4204d-154">En el caso de los roles con más de una instancia, el controlador de tejido garantiza que las instancias se distribuyen entre varios dominios de error, lo que evitar que errores aislados de hardware interrumpan el servicio.</span><span class="sxs-lookup"><span data-stu-id="4204d-154">For any role that has more than one instance, the fabric controller ensures that the instances are distributed across multiple fault domains, to prevent isolated hardware failures from disrupting service.</span></span> <span data-ttu-id="4204d-155">Los dominios de error rigen toda la exposición a errores en el servidor y en el clúster.</span><span class="sxs-lookup"><span data-stu-id="4204d-155">Fault domains govern all exposure to server and cluster failures.</span></span>

<span data-ttu-id="4204d-156">El [Acuerdo de Nivel de Servicio (SLA) de Azure](https://azure.microsoft.com/support/legal/sla/) garantiza que cuando se implementan dos o más instancias de rol web en diferentes dominios de error y de actualización, tendrán conectividad externa al menos el 99,95 % del tiempo.</span><span class="sxs-lookup"><span data-stu-id="4204d-156">The [Azure service-level agreement (SLA)](https://azure.microsoft.com/support/legal/sla/) guarantees that when two or more web role instances are deployed to different fault and upgrade domains, they'll have external connectivity at least 99.95 percent of the time.</span></span> <span data-ttu-id="4204d-157">A diferencia de los dominios de actualización, no hay forma de controlar el número de dominios de error.</span><span class="sxs-lookup"><span data-stu-id="4204d-157">Unlike update domains, there's no way to control the number of fault domains.</span></span> <span data-ttu-id="4204d-158">Azure asigna automáticamente los dominios de error y distribuye las instancias de rol entre ellos.</span><span class="sxs-lookup"><span data-stu-id="4204d-158">Azure automatically allocates fault domains and distributes role instances across them.</span></span> <span data-ttu-id="4204d-159">Al menos las dos primeras instancias de cada rol se colocan en diferentes dominios de error y de actualización para garantizar que cualquier rol con un mínimo de dos instancias cumple el Acuerdo de Nivel de Servicio.</span><span class="sxs-lookup"><span data-stu-id="4204d-159">At least the first two instances of every role are placed in different fault and upgrade domains to ensure that any role with at least two instances will satisfy the SLA.</span></span> <span data-ttu-id="4204d-160">Esto se representa en el diagrama siguiente.</span><span class="sxs-lookup"><span data-stu-id="4204d-160">This is represented in the following diagram.</span></span>

![Vista simplificada del aislamiento de los dominios de error](./images/technical-guidance-recovery-local-failures/partitioning-1.png)

### <a name="load-balancing"></a><span data-ttu-id="4204d-162">Equilibrio de carga</span><span class="sxs-lookup"><span data-stu-id="4204d-162">Load balancing</span></span>
<span data-ttu-id="4204d-163">Todo el tráfico entrante a un rol web pasa a través de un equilibrador de carga sin estado, que distribuye las solicitudes de clientes entre las instancias de rol.</span><span class="sxs-lookup"><span data-stu-id="4204d-163">All inbound traffic to a web role passes through a stateless load balancer, which distributes client requests among the role instances.</span></span> <span data-ttu-id="4204d-164">Las instancias de rol individuales no tienen direcciones IP públicas y no se pueden direccionar directamente desde Internet.</span><span class="sxs-lookup"><span data-stu-id="4204d-164">Individual role instances do not have public IP addresses, and they are not directly addressable from the Internet.</span></span> <span data-ttu-id="4204d-165">Los roles web no tienen estado, con el fin de que todas las solicitudes de clientes se puedan enrutar a cualquier instancia de rol.</span><span class="sxs-lookup"><span data-stu-id="4204d-165">Web roles are stateless so that any client request can be routed to any role instance.</span></span> <span data-ttu-id="4204d-166">Se desencadena un evento [StatusCheck](https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleenvironment.statuscheck.aspx) cada 15 segundos.</span><span class="sxs-lookup"><span data-stu-id="4204d-166">A [StatusCheck](https://msdn.microsoft.com/library/microsoft.windowsazure.serviceruntime.roleenvironment.statuscheck.aspx) event is raised every 15 seconds.</span></span> <span data-ttu-id="4204d-167">Esto se puede utilizar para indicar si el rol está listo para recibir tráfico o si está ocupado y debe quitarse de la rotación del equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="4204d-167">You can use this to indicate whether the role is ready to receive traffic, or whether it's busy and should be taken out of the load-balancer rotation.</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="4204d-168">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="4204d-168">Virtual Machines</span></span>
<span data-ttu-id="4204d-169">Azure Virtual Machines difiere de los roles de proceso de plataforma como servicio (PaaS) en varios aspectos relacionados con la alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-169">Azure Virtual Machines differs from platform as a service (PaaS) compute roles in several respects in relation to high availability.</span></span> <span data-ttu-id="4204d-170">En algunos casos, deberá realizar tareas adicionales para garantizar una alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-170">In some instances, you must do additional work to ensure high availability.</span></span>

### <a name="disk-durability"></a><span data-ttu-id="4204d-171">Durabilidad del disco</span><span class="sxs-lookup"><span data-stu-id="4204d-171">Disk durability</span></span>
<span data-ttu-id="4204d-172">A diferencia de las instancias de rol de PaaS, los datos almacenados en las unidades de máquinas virtuales son persistentes, aunque la máquina virtual se reasigne.</span><span class="sxs-lookup"><span data-stu-id="4204d-172">Unlike PaaS role instances, data stored on virtual machine drives is persistent even when the virtual machine is relocated.</span></span> <span data-ttu-id="4204d-173">Azure Virtual Machines usa discos de máquinas virtuales que existen como blobs en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4204d-173">Azure virtual machines use VM disks that exist as blobs in Azure Storage.</span></span> <span data-ttu-id="4204d-174">Debido a las características de disponibilidad de Azure Storage, los datos almacenados en las unidades de una máquina virtual también presentan una alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-174">Because of the availability characteristics of Azure Storage, the data stored on a virtual machine’s drives is also highly available.</span></span>

<span data-ttu-id="4204d-175">Tenga en cuenta que, en las máquinas virtuales de Windows, la unidad D es la excepción a esta regla.</span><span class="sxs-lookup"><span data-stu-id="4204d-175">Note that drive D (in Windows VMs) is the exception to this rule.</span></span> <span data-ttu-id="4204d-176">La unidad D es realmente un almacenamiento físico en el servidor en bastidor que hospeda la máquina virtual y sus datos se perderán si esta se recicla.</span><span class="sxs-lookup"><span data-stu-id="4204d-176">Drive D is actually physical storage on the rack server that hosts the VM, and its data will be lost if the VM is recycled.</span></span> <span data-ttu-id="4204d-177">La unidad D solo está prevista como almacenamiento temporal.</span><span class="sxs-lookup"><span data-stu-id="4204d-177">Drive D is intended for temporary storage only.</span></span> <span data-ttu-id="4204d-178">En Linux, Azure "normalmente" (pero no siempre) expone el disco local temporal como un dispositivo de bloques /dev/sdb.</span><span class="sxs-lookup"><span data-stu-id="4204d-178">In Linux, Azure “usually” (but not always) exposes the local temporary disk as /dev/sdb block device.</span></span> <span data-ttu-id="4204d-179">A menudo, el agente de Linux de Azure lo monta como los puntos de montaje /mnt/resource o /mnt (configurables mediante /etc/waagent.conf).</span><span class="sxs-lookup"><span data-stu-id="4204d-179">It is often mounted by the Azure Linux Agent as /mnt/resource or /mnt mount points (configurable via /etc/waagent.conf).</span></span>

### <a name="partitioning"></a><span data-ttu-id="4204d-180">Creación de particiones</span><span class="sxs-lookup"><span data-stu-id="4204d-180">Partitioning</span></span>
<span data-ttu-id="4204d-181">Azure entiende de manera nativa los niveles de una aplicación PaaS (rol web y rol de trabajo) y, por consiguiente, puede distribuirlos correctamente entre dominios de error y de actualización.</span><span class="sxs-lookup"><span data-stu-id="4204d-181">Azure natively understands the tiers in a PaaS application (web role and worker role) and thus can properly distribute them across fault and update domains.</span></span> <span data-ttu-id="4204d-182">En cambio, los niveles de una aplicación de infraestructura como servicio (IaaS) se deben definir manualmente a través de conjuntos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-182">In contrast, the tiers in an infrastructure as a service (IaaS) application must be manually defined through availability sets.</span></span> <span data-ttu-id="4204d-183">Los conjuntos de disponibilidad son necesarios para un Acuerdo de Nivel de Servicio en IaaS.</span><span class="sxs-lookup"><span data-stu-id="4204d-183">Availability sets are required for an SLA under IaaS.</span></span>

![Conjuntos de disponibilidad para Máquinas virtuales de Azure](./images/technical-guidance-recovery-local-failures/partitioning-2.png)

<span data-ttu-id="4204d-185">En el diagrama anterior, el nivel de Internet Information Services (IIS) (que funciona como nivel de aplicación web) y el nivel de SQL (que funciona como nivel de datos), se asignan a distintos conjuntos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-185">In the preceding diagram, the Internet Information Services (IIS) tier (which works as a web app tier) and the SQL tier (which works as a data tier) are assigned to different availability sets.</span></span> <span data-ttu-id="4204d-186">Esto garantiza que todas las instancias de cada nivel tienen redundancia de hardware mediante la distribución de máquinas virtuales entre los dominios de error y que no se quitan capas completas durante una actualización.</span><span class="sxs-lookup"><span data-stu-id="4204d-186">This ensures that all instances of each tier have hardware redundancy by distributing virtual machines across fault domains, and that entire tiers are not taken down during an update.</span></span>

### <a name="load-balancing"></a><span data-ttu-id="4204d-187">Equilibrio de carga</span><span class="sxs-lookup"><span data-stu-id="4204d-187">Load balancing</span></span>
<span data-ttu-id="4204d-188">Si hay que distribuir el tráfico entre las máquinas virtuales, tendrá que agruparlas en una aplicación y equilibrar la carga mediante un punto de conexión TCP o UDP específico.</span><span class="sxs-lookup"><span data-stu-id="4204d-188">If the VMs should have traffic distributed across them, you must group the VMs in an application and load balance across a specific TCP or UDP endpoint.</span></span> <span data-ttu-id="4204d-189">Para más información, consulte [Equilibrio de carga para servicios de infraestructura de Azure](/azure/virtual-machines/virtual-machines-linux-load-balance/?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="4204d-189">For more information, see [Load balancing virtual machines](/azure/virtual-machines/virtual-machines-linux-load-balance/?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="4204d-190">Si las máquinas virtuales reciben entradas de otro origen (por ejemplo, un mecanismo de puesta en cola), no será necesario un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="4204d-190">If the VMs receive input from another source (for example, a queuing mechanism), a load balancer is not required.</span></span> <span data-ttu-id="4204d-191">El equilibrador de carga utiliza una comprobación básica de mantenimiento para determinar si se debe enviar tráfico al nodo.</span><span class="sxs-lookup"><span data-stu-id="4204d-191">The load balancer uses a basic health check to determine whether traffic should be sent to the node.</span></span> <span data-ttu-id="4204d-192">También es posible crear sondeos propios que implementen métricas de mantenimiento específicas de la aplicación que determinen si la máquina virtual debe recibir tráfico.</span><span class="sxs-lookup"><span data-stu-id="4204d-192">It's also possible to create your own probes to implement application-specific health metrics that determine whether the VM should receive traffic.</span></span>

## <a name="storage"></a><span data-ttu-id="4204d-193">Storage</span><span class="sxs-lookup"><span data-stu-id="4204d-193">Storage</span></span>
<span data-ttu-id="4204d-194">Azure Storage es el servicio de datos duradero de línea de base de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-194">Azure Storage is the baseline durable data service for Azure.</span></span> <span data-ttu-id="4204d-195">Proporciona almacenamiento en blobs, tablas, colas y discos de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="4204d-195">It provides blob, table, queue, and VM disk storage.</span></span> <span data-ttu-id="4204d-196">Utiliza una combinación de replicación y administración de recursos para proporcionar alta disponibilidad en un centro de datos individual.</span><span class="sxs-lookup"><span data-stu-id="4204d-196">It uses a combination of replication and resource management to provide high availability within a single datacenter.</span></span> <span data-ttu-id="4204d-197">El Acuerdo de Nivel de Servicio de disponibilidad de Azure Storage garantiza que al menos un 99,9% del tiempo:</span><span class="sxs-lookup"><span data-stu-id="4204d-197">The Azure Storage availability SLA guarantees that at least 99.9 percent of the time:</span></span>

* <span data-ttu-id="4204d-198">Se procesarán correctamente las solicitudes con el formato correcto para agregar, actualizar, leer y eliminar datos.</span><span class="sxs-lookup"><span data-stu-id="4204d-198">Correctly formatted requests to add, update, read, and delete data will be successfully and correctly processed.</span></span>
* <span data-ttu-id="4204d-199">Las cuentas de almacenamiento tendrán conectividad con la puerta de enlace de Internet.</span><span class="sxs-lookup"><span data-stu-id="4204d-199">Storage accounts will have connectivity to the Internet gateway.</span></span>

### <a name="replication"></a><span data-ttu-id="4204d-200">Replicación</span><span class="sxs-lookup"><span data-stu-id="4204d-200">Replication</span></span>
<span data-ttu-id="4204d-201">Azure Storage facilita la durabilidad de los datos, para lo que mantiene varias copias de todos los datos en diferentes unidades ubicadas en subsistemas de almacenamiento físico totalmente independientes dentro de la región.</span><span class="sxs-lookup"><span data-stu-id="4204d-201">Azure Storage facilitates data durability by maintaining multiple copies of all data on different drives across fully independent physical storage subsystems within the region.</span></span> <span data-ttu-id="4204d-202">Los datos se replican de forma sincrónica y todas las copias se confirman antes de que se reconoce la operación de escritura.</span><span class="sxs-lookup"><span data-stu-id="4204d-202">Data is replicated synchronously, and all copies are committed before the write is acknowledged.</span></span> <span data-ttu-id="4204d-203">Azure Storage es muy coherente, lo cual significa que se garantiza que las operaciones de lectura reflejan las operaciones de escritura más recientes.</span><span class="sxs-lookup"><span data-stu-id="4204d-203">Azure Storage is strongly consistent, meaning that reads are guaranteed to reflect the most recent writes.</span></span> <span data-ttu-id="4204d-204">Además, las copias de los datos se examinan continuamente para detectar y reparar la degradación de bits, una amenaza para la integridad de los datos almacenados que a menudo se pasa por alto.</span><span class="sxs-lookup"><span data-stu-id="4204d-204">In addition, copies of data are continually scanned to detect and repair bit rot, an often overlooked threat to the integrity of stored data.</span></span>

<span data-ttu-id="4204d-205">Los servicios se pueden beneficiar de la replicación solo con usar Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4204d-205">Services benefit from replication just by using Azure Storage.</span></span> <span data-ttu-id="4204d-206">El desarrollador del servicio no necesita hacer ningún trabajo adicional para que se realice la recuperación de un error local.</span><span class="sxs-lookup"><span data-stu-id="4204d-206">The service developer doesn't need to do additional work to recover from a local failure.</span></span>

### <a name="resource-management"></a><span data-ttu-id="4204d-207">Administración de recursos</span><span class="sxs-lookup"><span data-stu-id="4204d-207">Resource management</span></span>
<span data-ttu-id="4204d-208">Las cuentas de almacenamiento creadas después de mayo de 2014 pueden tener hasta 500 TB (el máximo anterior era de 200 TB).</span><span class="sxs-lookup"><span data-stu-id="4204d-208">Storage accounts created after May 2014, can grow to up to 500 TB (the previous maximum was 200 TB).</span></span> <span data-ttu-id="4204d-209">Si se requiere espacio adicional, las aplicaciones se deberán diseñar para que usen varias cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="4204d-209">If additional space is required, applications must be designed to use multiple storage accounts.</span></span>

### <a name="virtual-machine-disks"></a><span data-ttu-id="4204d-210">Discos de máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="4204d-210">Virtual machine disks</span></span>
<span data-ttu-id="4204d-211">Un disco de máquina virtual se almacena como un blob en páginas en Azure Storage, lo que le otorga las mismas propiedades de durabilidad y escalabilidad que a Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="4204d-211">A virtual machine’s disk is stored as a page blob in Azure Storage, giving it all the same durability and scalability properties as Blob storage.</span></span> <span data-ttu-id="4204d-212">Este diseño hace que los datos de un disco de máquina virtual sean persistentes aunque se produzca un error en el servidor que ejecuta la máquina virtual y esta deba reiniciarse en otro servidor.</span><span class="sxs-lookup"><span data-stu-id="4204d-212">This design makes the data on a virtual machine’s disk persistent, even if the server running the VM fails and the VM must be restarted on another server.</span></span>

## <a name="database"></a><span data-ttu-id="4204d-213">Base de datos</span><span class="sxs-lookup"><span data-stu-id="4204d-213">Database</span></span>
### <a name="sql-database"></a><span data-ttu-id="4204d-214">SQL Database</span><span class="sxs-lookup"><span data-stu-id="4204d-214">SQL Database</span></span>
<span data-ttu-id="4204d-215">Azure SQL Database proporciona la base de datos como un servicio.</span><span class="sxs-lookup"><span data-stu-id="4204d-215">Azure SQL Database provides database as a service.</span></span> <span data-ttu-id="4204d-216">Permite que las aplicaciones se aprovisionen rápidamente bases de datos relacionales, inserten datos en ellas y las consulten.</span><span class="sxs-lookup"><span data-stu-id="4204d-216">It allows applications to quickly provision, insert data into, and query relational databases.</span></span> <span data-ttu-id="4204d-217">Proporciona muchas de las conocidas características y funcionalidades de SQL Server, al tiempo que reduce la carga de hardware, configuración, aplicación de revisiones y resistencia.</span><span class="sxs-lookup"><span data-stu-id="4204d-217">It provides many of the familiar SQL Server features and functionality, while abstracting the burden of hardware, configuration, patching, and resiliency.</span></span>

> [!NOTE]
> <span data-ttu-id="4204d-218">Azure SQL Database no proporciona una paridad de características uno a uno con SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4204d-218">Azure SQL Database does not provide one-to-one feature parity with SQL Server.</span></span> <span data-ttu-id="4204d-219">Está pensada para satisfacer un conjunto diferente de requisitos, que es adecuado exclusivamente para aplicaciones en la nube (escala elástica, base de datos como servicio para reducir costos de mantenimiento, etc.).</span><span class="sxs-lookup"><span data-stu-id="4204d-219">It's intended to fulfill a different set of requirements--one that's uniquely suited to cloud applications (elastic scale, database as a service to reduce maintenance costs, and so on).</span></span> <span data-ttu-id="4204d-220">Para obtener más información, consulte [Selección de una opción de SQL Server en la nube: Base de datos (PaaS) SQL de Azure o SQL Server en máquinas virtuales de Azure (IaaS)](/azure/sql-database/sql-database-paas-vs-sql-server-iaas/).</span><span class="sxs-lookup"><span data-stu-id="4204d-220">For more information, see [Choose a cloud SQL Server option: Azure SQL (PaaS) Database or SQL Server on Azure VMs (IaaS)](/azure/sql-database/sql-database-paas-vs-sql-server-iaas/).</span></span>
> 
> 

#### <a name="replication"></a><span data-ttu-id="4204d-221">Replicación</span><span class="sxs-lookup"><span data-stu-id="4204d-221">Replication</span></span>
<span data-ttu-id="4204d-222">Azure SQL Database proporciona resistencia integrada a errores en el nivel de nodo.</span><span class="sxs-lookup"><span data-stu-id="4204d-222">Azure SQL Database provides built-in resiliency to node-level failure.</span></span> <span data-ttu-id="4204d-223">Todas las operaciones de escritura que se realizan en una base de datos se replican automáticamente en dos o más nodos en segundo plano mediante una técnica de confirmación de quórum.</span><span class="sxs-lookup"><span data-stu-id="4204d-223">All writes into a database are automatically replicated to two or more background nodes through a quorum commit technique.</span></span> <span data-ttu-id="4204d-224">(tanto el nodo principal como al menos un nodo secundario deben confirmar que la actividad se escribe en el registro de transacciones antes de que la transacción se considere correcta y se devuelve). En caso de error del nodo, la base de datos automáticamente se conmuta por error a una de las réplicas secundarias.</span><span class="sxs-lookup"><span data-stu-id="4204d-224">(The primary and at least one secondary must confirm that the activity is written to the transaction log before the transaction is deemed successful and returns.) In the case of node failure, the database automatically fails over to one of the secondary replicas.</span></span> <span data-ttu-id="4204d-225">Esto produce una interrupción de la conexión transitoria para las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="4204d-225">This causes a transient connection interruption for client applications.</span></span> <span data-ttu-id="4204d-226">Por este motivo, todos los clientes de Azure SQL Database deben implementar alguna forma de control de conexiones transitorias.</span><span class="sxs-lookup"><span data-stu-id="4204d-226">For this reason, all Azure SQL Database clients must implement some form of transient connection handling.</span></span> <span data-ttu-id="4204d-227">Para más información, consulte [Vuelva a intentar la orientación específica del servicio](/azure/best-practices-retry-service-specific/).</span><span class="sxs-lookup"><span data-stu-id="4204d-227">For more information, see [Retry service specific guidance](/azure/best-practices-retry-service-specific/).</span></span>

#### <a name="resource-management"></a><span data-ttu-id="4204d-228">Administración de recursos</span><span class="sxs-lookup"><span data-stu-id="4204d-228">Resource management</span></span>
<span data-ttu-id="4204d-229">Cada base de datos, cuando se crea, se configura con un límite de tamaño superior.</span><span class="sxs-lookup"><span data-stu-id="4204d-229">Each database, when created, is configured with an upper size limit.</span></span> <span data-ttu-id="4204d-230">El tamaño máximo actualmente disponible es de 1 TB (los límites de tamaño varían según su nivel de servicio, consulte [Niveles de servicio y niveles de rendimiento de Azure SQL Database](/azure/sql-database/sql-database-resource-limits/#service-tiers-and-performance-levels).</span><span class="sxs-lookup"><span data-stu-id="4204d-230">The currently available maximum size is 1 TB (size limits vary based on your service tier, see [service tiers and performance levels of Azure SQL Databases](/azure/sql-database/sql-database-resource-limits/#service-tiers-and-performance-levels).</span></span> <span data-ttu-id="4204d-231">Cuando una base de datos alcanza su límite superior de tamaño, rechaza comandos INSERT o UPDATE adicionales</span><span class="sxs-lookup"><span data-stu-id="4204d-231">When a database hits its upper size limit, it rejects additional INSERT or UPDATE commands.</span></span> <span data-ttu-id="4204d-232">(la consulta y eliminación de datos aún es posible).</span><span class="sxs-lookup"><span data-stu-id="4204d-232">(Querying and deleting data is still possible.)</span></span>

<span data-ttu-id="4204d-233">En una base de datos, Azure SQL Database usa un tejido para administrar los recursos.</span><span class="sxs-lookup"><span data-stu-id="4204d-233">Within a database, Azure SQL Database uses a fabric to manage resources.</span></span> <span data-ttu-id="4204d-234">No obstante, en lugar de un controlador de tejido, usa una topología en anillo para detectar errores.</span><span class="sxs-lookup"><span data-stu-id="4204d-234">However, instead of a fabric controller, it uses a ring topology to detect failures.</span></span> <span data-ttu-id="4204d-235">Cada réplica de un clúster tienen dos vecinos y es responsable de detectar cuándo estos dejan de funcionar.</span><span class="sxs-lookup"><span data-stu-id="4204d-235">Every replica in a cluster has two neighbors and is responsible for detecting when they go down.</span></span> <span data-ttu-id="4204d-236">Cuando una réplica deja de funcionar, sus vecinos desencadenan un agente de reconfiguración que la vuelve a crear en otra máquina.</span><span class="sxs-lookup"><span data-stu-id="4204d-236">When a replica goes down, its neighbors trigger a reconfiguration agent to re-create it on another machine.</span></span> <span data-ttu-id="4204d-237">Se proporciona limitación del motor para garantizar que un servidor lógico no usa demasiados recursos de una máquina ni supera los límites físicos de la misma.</span><span class="sxs-lookup"><span data-stu-id="4204d-237">Engine throttling is provided to ensure that a logical server doesn't use too many resources on a machine or exceed the machine’s physical limits.</span></span>

### <a name="elasticity"></a><span data-ttu-id="4204d-238">Elasticidad</span><span class="sxs-lookup"><span data-stu-id="4204d-238">Elasticity</span></span>
<span data-ttu-id="4204d-239">Si la aplicación requiere más espacio que el límite de 1 TB de la base de datos, deberá implementar un enfoque de escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="4204d-239">If the application requires more than the 1 TB database limit, it must implement a scale-out approach.</span></span> <span data-ttu-id="4204d-240">El escalado horizontal con Azure SQL Database se realiza mediante la creación manual de particiones, operación que también se denomina particionamiento, de datos en varias instancias de SQL Database.</span><span class="sxs-lookup"><span data-stu-id="4204d-240">You scale out with Azure SQL Database by manually partitioning, also known as sharding, data across multiple SQL databases.</span></span> <span data-ttu-id="4204d-241">Este enfoque de escalado horizontal brinda la oportunidad de lograr un crecimiento del costo casi lineal con la escala.</span><span class="sxs-lookup"><span data-stu-id="4204d-241">This scale-out approach provides the opportunity to achieve nearly linear cost growth with scale.</span></span> <span data-ttu-id="4204d-242">El crecimiento elástico o la capacidad a petición pueden aumentar según sea necesario, lo cual implicará un aumento de los costos, ya que las bases de datos se facturan según el tamaño real promedio usado cada día, y no según el tamaño máximo posible.</span><span class="sxs-lookup"><span data-stu-id="4204d-242">Elastic growth or capacity on demand can grow with incremental costs as needed because databases are billed based on the average actual size used per day, not based on maximum possible size.</span></span>

## <a name="sql-server-on-virtual-machines"></a><span data-ttu-id="4204d-243">SQL Server en máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="4204d-243">SQL Server on Virtual Machines</span></span>
<span data-ttu-id="4204d-244">Si instala SQL Server en (versión 2014 o posterior) Azure Virtual Machines, podrá sacar provecho de las características de disponibilidad tradicionales de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="4204d-244">By installing SQL Server (version 2014 or later) on Azure Virtual Machines, you can take advantage of the traditional availability features of SQL Server.</span></span> <span data-ttu-id="4204d-245">Dichas características incluyen grupos de disponibilidad AlwaysOn y creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4204d-245">These features include AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="4204d-246">Tenga en cuenta que las máquinas virtuales de Azure, el almacenamiento y las redes tienen características operativas diferentes de las de una infraestructura de TI local y no virtualizada.</span><span class="sxs-lookup"><span data-stu-id="4204d-246">Note that Azure VMs, storage, and networking have different operational characteristics than an on-premises, non-virtualized IT infrastructure.</span></span> <span data-ttu-id="4204d-247">Para implementar correctamente una solución de alta disponibilidad y recuperación ante desastres (HA/DR) de SQL Server en Azure es preciso conocer estas diferencias y diseñar la solución de tal forma que se adapte a ellas.</span><span class="sxs-lookup"><span data-stu-id="4204d-247">A successful implementation of a high availability/disaster recovery (HA/DR) SQL Server solution in Azure requires that you understand these differences and design your solution to accommodate them.</span></span>

### <a name="high-availability-nodes-in-an-availability-set"></a><span data-ttu-id="4204d-248">Nodos de alta disponibilidad en un conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="4204d-248">High-availability nodes in an availability set</span></span>
<span data-ttu-id="4204d-249">Cuando implementa una solución de alta disponibilidad en Azure, se puede usar el conjunto de disponibilidad de Azure para colocar los nodos de alta disponibilidad en dominios de error y de actualización independientes.</span><span class="sxs-lookup"><span data-stu-id="4204d-249">When you implement a high-availability solution in Azure, you can use the availability set in Azure to place the high-availability nodes into separate fault domains and upgrade domains.</span></span> <span data-ttu-id="4204d-250">Para ser más precisos, "conjunto de disponibilidad" es un concepto de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-250">To be clear, the availability set is an Azure concept.</span></span> <span data-ttu-id="4204d-251">Se trata de un procedimiento recomendado que debe seguir para asegurarse de que las bases de datos tienen realmente una alta disponibilidad, independientemente de que se utilicen grupos de disponibilidad AlwaysOn, creación de reflejo de la base de datos o cualquier otra característica.</span><span class="sxs-lookup"><span data-stu-id="4204d-251">It's a best practice that you should follow to make sure that your databases are indeed highly available, whether you're using AlwaysOn Availability Groups, database mirroring, or something else.</span></span> <span data-ttu-id="4204d-252">Si no sigue este procedimiento, es posible que tenga la certeza incorrecta de que su sistema tiene alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-252">If you don't follow this best practice, you might be under the false assumption that your system is highly available.</span></span> <span data-ttu-id="4204d-253">Pero en realidad, todos los nodos pueden dejar de funcionar simultáneamente porque están colocados en el mismo dominio de error de la región de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-253">But in reality, your nodes can all fail simultaneously because they happen to be placed in the same fault domain in the Azure region.</span></span>

<span data-ttu-id="4204d-254">Esta recomendación no tiene tanta validez con el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="4204d-254">This recommendation is not as applicable with log shipping.</span></span> <span data-ttu-id="4204d-255">Al tratarse de una característica de recuperación ante desastres, debe asegurarse de que los servidores se ejecutan en regiones independientes de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-255">As a disaster recovery feature, you should ensure that the servers are running in separate Azure regions.</span></span> <span data-ttu-id="4204d-256">Por definición, estas regiones son dominios de error independientes.</span><span class="sxs-lookup"><span data-stu-id="4204d-256">By definition, these regions are separate fault domains.</span></span>

<span data-ttu-id="4204d-257">En el caso de las máquinas virtuales en Azure Cloud Services implementadas mediante el portal clásico en el mismo conjunto de disponibilidad, debe implementarlas en el mismo servicio en la nube.</span><span class="sxs-lookup"><span data-stu-id="4204d-257">For Azure Cloud Services VMs deployed through the classic portal to be in the same availability set, you must deploy them in the same Cloud Service.</span></span> <span data-ttu-id="4204d-258">Las máquinas virtuales implementadas mediante Azure Resource Manager (el portal actual) no tienen esta limitación.</span><span class="sxs-lookup"><span data-stu-id="4204d-258">VMs deployed through Azure Resource Manager (the current portal) do not have this limitation.</span></span> <span data-ttu-id="4204d-259">En el caso de las máquinas virtuales implementadas mediante el portal clásico en el servicio en la nube de Azure, solo los nodos en el mismo servicio en la nube pueden participar en el mismo conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-259">For classic portal deployed VMs in Azure Cloud Service, only nodes in the same Cloud Service can participate in the same availability set.</span></span> <span data-ttu-id="4204d-260">Además, las máquinas virtuales en Cloud Services deben estar en la misma red virtual para asegurarse de que conservan sus direcciones IP incluso después de la recuperación del servicio,</span><span class="sxs-lookup"><span data-stu-id="4204d-260">In addition, the Cloud Services VMs should be in the same virtual network to ensure that they maintain their IPs even after service healing.</span></span> <span data-ttu-id="4204d-261">ya que esto evita las interrupciones de actualización de DNS.</span><span class="sxs-lookup"><span data-stu-id="4204d-261">This avoids DNS update disruptions.</span></span>

### <a name="azure-only-high-availability-solutions"></a><span data-ttu-id="4204d-262">Solo Azure: soluciones de alta disponibilidad</span><span class="sxs-lookup"><span data-stu-id="4204d-262">Azure-only: High-availability solutions</span></span>
<span data-ttu-id="4204d-263">Puede tener una solución de alta disponibilidad para sus bases de datos SQL Server en Azure mediante el uso de grupos de disponibilidad AlwaysOn o de creación de reflejo de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4204d-263">You can have a high-availability solution for your SQL Server databases in Azure by using AlwaysOn Availability Groups or database mirroring.</span></span>

<span data-ttu-id="4204d-264">El siguiente diagrama muestra la arquitectura de los grupos de disponibilidad AlwaysOn que se ejecutan en Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="4204d-264">The following diagram demonstrates the architecture of AlwaysOn Availability Groups running on Azure Virtual Machines.</span></span> <span data-ttu-id="4204d-265">Este diagrama se ha tomado del artículo [Alta disponibilidad y recuperación ante desastres para SQL Server en Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/), en el que se analiza en profundidad este tema.</span><span class="sxs-lookup"><span data-stu-id="4204d-265">This diagram was taken from the in-depth article on this subject, [High availability and disaster recovery for SQL Server on Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

![Grupos de disponibilidad de AlwaysOn en Microsoft Azure](./images/technical-guidance-recovery-local-failures/high_availability_solutions-1.png)

<span data-ttu-id="4204d-267">También puede aprovisionar automáticamente una implementación de grupos de disponibilidad AlwaysOn de un extremo a otro en máquinas virtuales de Azure mediante el uso de la plantilla de AlwaysOn en el Portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-267">You can also automatically provision an AlwaysOn Availability Groups deployment end-to-end on Azure VMs by using the AlwaysOn template in the Azure portal.</span></span> <span data-ttu-id="4204d-268">Para obtener más información, consulte [Oferta de AlwaysOn de SQL Server en la Galería de Microsoft Azure Portal](https://blogs.technet.microsoft.com/dataplatforminsider/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery/).</span><span class="sxs-lookup"><span data-stu-id="4204d-268">For more information, see [SQL Server AlwaysOn Offering in Microsoft Azure Portal Gallery](https://blogs.technet.microsoft.com/dataplatforminsider/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery/).</span></span>

<span data-ttu-id="4204d-269">El diagrama siguiente muestra el uso de creación de reflejo de la base de datos en Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="4204d-269">The following diagram demonstrates the use of database mirroring on Azure Virtual Machines.</span></span> <span data-ttu-id="4204d-270">También se ha tomado del artículo [Alta disponibilidad y recuperación ante desastres para SQL Server en Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span><span class="sxs-lookup"><span data-stu-id="4204d-270">It was also taken from the in-depth topic [High availability and disaster recovery for SQL Server on Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

![Creación de reflejo de la base de datos en Microsoft Azure](./images/technical-guidance-recovery-local-failures/high_availability_solutions-2.png)

> [!NOTE]
> <span data-ttu-id="4204d-272">En ambas arquitecturas se requiere un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="4204d-272">Both architectures require a domain controller.</span></span> <span data-ttu-id="4204d-273">Sin embargo, con creación de reflejo de la base de datos se pueden utilizar certificados de servidor para eliminar la necesidad de un controlador de dominio.</span><span class="sxs-lookup"><span data-stu-id="4204d-273">However, with database mirroring, it's possible to use server certificates to eliminate the need for a domain controller.</span></span>
> 
> 

## <a name="other-azure-platform-services"></a><span data-ttu-id="4204d-274">Otros servicios de la plataforma de Azure</span><span class="sxs-lookup"><span data-stu-id="4204d-274">Other Azure platform services</span></span>
<span data-ttu-id="4204d-275">Las aplicaciones que se basan en Azure se benefician de las capacidades de la plataforma para recuperarse de errores locales.</span><span class="sxs-lookup"><span data-stu-id="4204d-275">Applications that are built on Azure benefit from platform capabilities to recover from local failures.</span></span> <span data-ttu-id="4204d-276">En algunos casos, se pueden realizar acciones concretas para aumentar la disponibilidad de un escenario concreto.</span><span class="sxs-lookup"><span data-stu-id="4204d-276">In some cases, you can take specific actions to increase availability for your specific scenario.</span></span>

### <a name="service-bus"></a><span data-ttu-id="4204d-277">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="4204d-277">Service Bus</span></span>
<span data-ttu-id="4204d-278">Para mitigar una interrupción temporal de Azure Service Bus, considere la posibilidad de crear una cola duradera en el lado de cliente.</span><span class="sxs-lookup"><span data-stu-id="4204d-278">To mitigate against a temporary outage of Azure Service Bus, consider creating a durable client-side queue.</span></span> <span data-ttu-id="4204d-279">Con ello, utilizará temporalmente un mecanismo de almacenamiento local alternativo para almacenar los mensajes que no se puedan agregar a la cola de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4204d-279">This temporarily uses an alternate, local storage mechanism to store messages that cannot be added to the Service Bus queue.</span></span> <span data-ttu-id="4204d-280">La aplicación puede decidir cómo controlar los mensajes almacenados temporalmente una vez restaurado el servicio.</span><span class="sxs-lookup"><span data-stu-id="4204d-280">The application can decide how to handle the temporarily stored messages after the service is restored.</span></span> <span data-ttu-id="4204d-281">Para obtener más información, consulte [Prácticas recomendadas para la realización de mejoras con la mensajería asincrónica de Service Bus](/azure/service-bus-messaging/service-bus-performance-improvements/) y [Service Bus (recuperación ante desastres)](recovery-loss-azure-region.md#other-azure-platform-services).</span><span class="sxs-lookup"><span data-stu-id="4204d-281">For more information, see [Best practices for performance improvements using Service Bus brokered messaging](/azure/service-bus-messaging/service-bus-performance-improvements/) and [Service Bus (disaster recovery)](recovery-loss-azure-region.md#other-azure-platform-services).</span></span>

### <a name="hdinsight"></a><span data-ttu-id="4204d-282">HDInsight</span><span class="sxs-lookup"><span data-stu-id="4204d-282">HDInsight</span></span>
<span data-ttu-id="4204d-283">Los datos asociados a HDInsight de Azure se almacenan de forma predeterminada en el Almacenamiento de blobs de Azure.</span><span class="sxs-lookup"><span data-stu-id="4204d-283">The data that's associated with Azure HDInsight is stored by default in Azure Blob storage.</span></span> <span data-ttu-id="4204d-284">Azure Storage especifica las propiedades de durabilidad y alta disponibilidad de Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="4204d-284">Azure Storage specifies high-availability and durability properties for Blob storage.</span></span> <span data-ttu-id="4204d-285">El procesamiento de varios nodos asociado a los trabajos MapReduce de Hadoop se realiza en un sistema de archivos distribuido Hadoop (HDFS) transitorio que se aprovisiona cuando HDInsight lo necesita.</span><span class="sxs-lookup"><span data-stu-id="4204d-285">The multiple-node processing that's associated with Hadoop MapReduce jobs occurs on a transient Hadoop Distributed File System (HDFS) that is provisioned when HDInsight needs it.</span></span> <span data-ttu-id="4204d-286">Los resultados de un trabajo MapReduce también se almacenan de forma predeterminada en Almacenamiento de blobs de Azure, con el fin de que los datos procesados sean duraderos y tengan una alta disponibilidad después de que el clúster de Hadoop se desaprovisione.</span><span class="sxs-lookup"><span data-stu-id="4204d-286">Results from a MapReduce job are also stored by default in Azure Blob storage, so that the processed data is durable and remains highly available after the Hadoop cluster is deprovisioned.</span></span> <span data-ttu-id="4204d-287">Para obtener más información, consulte [HDInsight (recuperación ante desastres)](recovery-loss-azure-region.md#other-azure-platform-services).</span><span class="sxs-lookup"><span data-stu-id="4204d-287">For more information, see [HDInsight (disaster recovery)](recovery-loss-azure-region.md#other-azure-platform-services).</span></span>

## <a name="checklists-for-local-failures"></a><span data-ttu-id="4204d-288">Listas de comprobación para errores locales</span><span class="sxs-lookup"><span data-stu-id="4204d-288">Checklists for local failures</span></span>
### <a name="cloud-services"></a><span data-ttu-id="4204d-289">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="4204d-289">Cloud Services</span></span>
1. <span data-ttu-id="4204d-290">Revise la sección Cloud Services de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-290">Review the Cloud Services section of this document.</span></span>
2. <span data-ttu-id="4204d-291">Configure al menos dos instancias para cada rol.</span><span class="sxs-lookup"><span data-stu-id="4204d-291">Configure at least two instances for each role.</span></span>
3. <span data-ttu-id="4204d-292">Conserve el estado en un almacenamiento durable, no en instancias de rol.</span><span class="sxs-lookup"><span data-stu-id="4204d-292">Persist state in durable storage, not on role instances.</span></span>
4. <span data-ttu-id="4204d-293">Controle correctamente el evento StatusCheck.</span><span class="sxs-lookup"><span data-stu-id="4204d-293">Correctly handle the StatusCheck event.</span></span>
5. <span data-ttu-id="4204d-294">Encapsule los cambios relacionados en transacciones siempre que sea posible.</span><span class="sxs-lookup"><span data-stu-id="4204d-294">Wrap related changes in transactions when possible.</span></span>
6. <span data-ttu-id="4204d-295">Compruebe que las tareas del rol de trabajo son idempotentes y reiniciables.</span><span class="sxs-lookup"><span data-stu-id="4204d-295">Verify that worker role tasks are idempotent and restartable.</span></span>
7. <span data-ttu-id="4204d-296">Continúe invocando las operaciones hasta que se completen satisfactoriamente.</span><span class="sxs-lookup"><span data-stu-id="4204d-296">Continue to invoke operations until they succeed.</span></span>
8. <span data-ttu-id="4204d-297">Considere estrategias de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="4204d-297">Consider autoscaling strategies.</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="4204d-298">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="4204d-298">Virtual Machines</span></span>
1. <span data-ttu-id="4204d-299">Revise la sección Máquinas virtuales de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-299">Review the Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="4204d-300">No utilice la unidad D para el almacenamiento persistente.</span><span class="sxs-lookup"><span data-stu-id="4204d-300">Do not use drive D for persistent storage.</span></span>
3. <span data-ttu-id="4204d-301">Agrupe las máquinas de un nivel de servicio en un conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-301">Group machines in a service tier into an availability set.</span></span>
4. <span data-ttu-id="4204d-302">Configure el equilibrio de carga y los sondeos opcionales.</span><span class="sxs-lookup"><span data-stu-id="4204d-302">Configure load balancing and optional probes.</span></span>

### <a name="storage"></a><span data-ttu-id="4204d-303">Storage</span><span class="sxs-lookup"><span data-stu-id="4204d-303">Storage</span></span>
1. <span data-ttu-id="4204d-304">Revise la sección Almacenamiento de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-304">Review the Storage section of this document.</span></span>
2. <span data-ttu-id="4204d-305">Utilice varias cuentas de almacenamiento cuando los datos o el ancho de banda superen las cuotas.</span><span class="sxs-lookup"><span data-stu-id="4204d-305">Use multiple storage accounts when data or bandwidth exceeds quotas.</span></span>

### <a name="sql-database"></a><span data-ttu-id="4204d-306">SQL Database</span><span class="sxs-lookup"><span data-stu-id="4204d-306">SQL Database</span></span>
1. <span data-ttu-id="4204d-307">Revise la sección SQL Database de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-307">Review the SQL Database section of this document.</span></span>
2. <span data-ttu-id="4204d-308">Implemente una directiva de reintentos para controlar los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="4204d-308">Implement a retry policy to handle transient errors.</span></span>
3. <span data-ttu-id="4204d-309">Utilice el particionamiento como estrategia de escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="4204d-309">Use partitioning/sharding as a scale-out strategy.</span></span>

### <a name="sql-server-on-virtual-machines"></a><span data-ttu-id="4204d-310">SQL Server en máquinas virtuales</span><span class="sxs-lookup"><span data-stu-id="4204d-310">SQL Server on Virtual Machines</span></span>
1. <span data-ttu-id="4204d-311">Revise la sección SQL Server en máquinas virtuales de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-311">Review the SQL Server on Virtual Machines section of this document.</span></span>
2. <span data-ttu-id="4204d-312">Siga las recomendaciones anteriores para Máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="4204d-312">Follow the previous recommendations for Virtual Machines.</span></span>
3. <span data-ttu-id="4204d-313">Use las características de alta disponibilidad de SQL Server, como AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="4204d-313">Use SQL Server high availability features, such as AlwaysOn.</span></span>

### <a name="service-bus"></a><span data-ttu-id="4204d-314">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="4204d-314">Service Bus</span></span>
1. <span data-ttu-id="4204d-315">Revise la sección Service Bus de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-315">Review the Service Bus section of this document.</span></span>
2. <span data-ttu-id="4204d-316">Considere la creación de una cola duradera en el lado del cliente como copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="4204d-316">Consider creating a durable client-side queue as a backup.</span></span>

### <a name="hdinsight"></a><span data-ttu-id="4204d-317">HDInsight</span><span class="sxs-lookup"><span data-stu-id="4204d-317">HDInsight</span></span>
1. <span data-ttu-id="4204d-318">Revise la sección HDInsight de este documento.</span><span class="sxs-lookup"><span data-stu-id="4204d-318">Review the HDInsight section of this document.</span></span>
2. <span data-ttu-id="4204d-319">Para los errores locales no se requieren más pasos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="4204d-319">No additional availability steps are required for local failures.</span></span>

