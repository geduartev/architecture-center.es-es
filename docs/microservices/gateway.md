---
title: Puertas de enlace de API
description: Puertas de enlace de API en microservicios
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 6483d416363e24f4084d6b856847a740bf4054d9
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/29/2017
ms.locfileid: "27549185"
---
# <a name="designing-microservices-api-gateways"></a><span data-ttu-id="b6d62-103">Diseño de microservicios: puertas de enlace de API</span><span class="sxs-lookup"><span data-stu-id="b6d62-103">Designing microservices: API gateways</span></span>

<span data-ttu-id="b6d62-104">En una arquitectura de microservicios, un cliente puede interactuar con más de un servicio front-end.</span><span class="sxs-lookup"><span data-stu-id="b6d62-104">In a microservices architecture, a client might interact with more than one front-end service.</span></span> <span data-ttu-id="b6d62-105">Así, ¿cómo un cliente sabe a qué puntos de conexión llamar?</span><span class="sxs-lookup"><span data-stu-id="b6d62-105">Given this fact, how does a client know what endpoints to call?</span></span> <span data-ttu-id="b6d62-106">¿Qué ocurre cuando se introducen nuevos servicios o los servicios existentes se refactorizan?</span><span class="sxs-lookup"><span data-stu-id="b6d62-106">What happens when new services are introduced, or existing services are refactored?</span></span> <span data-ttu-id="b6d62-107">¿Cómo abordan los servicios la terminación SSL, la autenticación y otros problemas?</span><span class="sxs-lookup"><span data-stu-id="b6d62-107">How do services handle SSL termination, authentication, and other concerns?</span></span> <span data-ttu-id="b6d62-108">Una *puerta de enlace de API* puede ayudar a superar estos desafíos.</span><span class="sxs-lookup"><span data-stu-id="b6d62-108">An *API gateway* can help to address these challenges.</span></span> 

![](./images/gateway.png)

## <a name="what-is-an-api-gateway"></a><span data-ttu-id="b6d62-109">¿Qué es una puerta de enlace de API?</span><span class="sxs-lookup"><span data-stu-id="b6d62-109">What is an API gateway?</span></span>

<span data-ttu-id="b6d62-110">Una puerta de enlace de API se ubica entre los clientes y los servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-110">An API gateway sits between clients and services.</span></span> <span data-ttu-id="b6d62-111">Actúa como un proxy inverso, enrutando las solicitudes de los clientes a los servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-111">It acts as a reverse proxy, routing requests from clients to services.</span></span> <span data-ttu-id="b6d62-112">También puede realizar diversas tareas transversales como la autenticación, la terminación SSL y la limitación de velocidad.</span><span class="sxs-lookup"><span data-stu-id="b6d62-112">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> <span data-ttu-id="b6d62-113">Si no implementa una puerta de enlace, los clientes deben enviar las solicitudes directamente a los servicios front-end.</span><span class="sxs-lookup"><span data-stu-id="b6d62-113">If you don't deploy a gateway, clients must send requests directly to front-end services.</span></span> <span data-ttu-id="b6d62-114">Sin embargo, hay algunos posibles problemas al exponer los servicios directamente a los clientes:</span><span class="sxs-lookup"><span data-stu-id="b6d62-114">However, there are some potential problems with exposing services directly to clients:</span></span>

- <span data-ttu-id="b6d62-115">Puede dar como resultado un código de cliente complejo.</span><span class="sxs-lookup"><span data-stu-id="b6d62-115">It can result in complex client code.</span></span> <span data-ttu-id="b6d62-116">El cliente debe realizar un seguimiento de varios puntos de conexión y controlar los errores de una manera flexible.</span><span class="sxs-lookup"><span data-stu-id="b6d62-116">The client must keep track of multiple endpoints, and handle failures in a resilient way.</span></span> 
- <span data-ttu-id="b6d62-117">Crea acoplamiento entre el cliente y el back-end.</span><span class="sxs-lookup"><span data-stu-id="b6d62-117">It creates coupling between the client and the backend.</span></span> <span data-ttu-id="b6d62-118">El cliente debe saber cómo se descomponen los servicios individuales.</span><span class="sxs-lookup"><span data-stu-id="b6d62-118">The client needs to know how the individual services are decomposed.</span></span> <span data-ttu-id="b6d62-119">Eso dificulta mantener al cliente y también refactorizar los servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-119">That makes it harder to maintain the client and also harder to refactor services.</span></span>
- <span data-ttu-id="b6d62-120">Una única operación podría requerir llamadas a varios servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-120">A single operation might require calls to multiple services.</span></span> <span data-ttu-id="b6d62-121">Esto puede provocar varios recorridos de ida y vuelta entre el cliente y el servidor, lo que añade una latencia significativa.</span><span class="sxs-lookup"><span data-stu-id="b6d62-121">That can result in multiple network round trips between the client and the server, adding significant latency.</span></span> 
- <span data-ttu-id="b6d62-122">Cada servicio expuesto al público debe controlar aspectos complejos, como la autenticación, SSL y la limitación de velocidad del cliente.</span><span class="sxs-lookup"><span data-stu-id="b6d62-122">Each public-facing service must handle concerns such as authentication, SSL, and client rate limiting.</span></span> 
- <span data-ttu-id="b6d62-123">Los servicios deben exponer un protocolo conocido para el cliente, como HTTP o WebSocket.</span><span class="sxs-lookup"><span data-stu-id="b6d62-123">Services must expose a client-friendly protocol such as HTTP or WebSocket.</span></span> <span data-ttu-id="b6d62-124">Esto limita la elección de los [protocolos de comunicación](./interservice-communication.md).</span><span class="sxs-lookup"><span data-stu-id="b6d62-124">This limits the choice of [communication protocols](./interservice-communication.md).</span></span> 
- <span data-ttu-id="b6d62-125">Los servicios con puntos de conexión públicos constituyen una posible superficie de ataque y deben ser protegidos.</span><span class="sxs-lookup"><span data-stu-id="b6d62-125">Services with public endpoints are a potential attack surface, and must be hardened.</span></span>

<span data-ttu-id="b6d62-126">Una puerta de enlace ayuda a solucionar estos problemas al desacoplar los clientes de los servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-126">A gateway helps to address these issues by decoupling clients from services.</span></span> <span data-ttu-id="b6d62-127">Las puertas de enlace pueden realizar una serie de funciones diferentes y es posible que no necesite todas.</span><span class="sxs-lookup"><span data-stu-id="b6d62-127">Gateways can perform a number of different functions, and you may not need all of them.</span></span> <span data-ttu-id="b6d62-128">Las funciones se pueden agrupar en los siguientes patrones de diseño:</span><span class="sxs-lookup"><span data-stu-id="b6d62-128">The functions can be grouped into the following design patterns:</span></span>

<span data-ttu-id="b6d62-129">[Enrutamiento de puertas de enlace](../patterns/gateway-routing.md)</span><span class="sxs-lookup"><span data-stu-id="b6d62-129">[Gateway Routing](../patterns/gateway-routing.md).</span></span> <span data-ttu-id="b6d62-130">Use la puerta de enlace como un proxy inverso para enrutar las solicitudes a uno o varios servicios back-end, usando el enrutamiento de nivel 7.</span><span class="sxs-lookup"><span data-stu-id="b6d62-130">Use the gateway as a reverse proxy to route requests to one or more backend services, using layer 7 routing.</span></span> <span data-ttu-id="b6d62-131">La puerta de enlace proporciona un único punto de conexión para los clientes y ayuda a desacoplar a los clientes de los servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-131">The gateway provides a single endpoint for clients, and helps to decouple clients from services.</span></span> 

<span data-ttu-id="b6d62-132">[Agregación de puertas de enlace](../patterns/gateway-aggregation.md).</span><span class="sxs-lookup"><span data-stu-id="b6d62-132">[Gateway Aggregation](../patterns/gateway-aggregation.md).</span></span> <span data-ttu-id="b6d62-133">Use una puerta de enlace para agregar varias solicitudes individuales en una sola solicitud.</span><span class="sxs-lookup"><span data-stu-id="b6d62-133">Use the gateway to aggregate multiple individual requests into a single request.</span></span> <span data-ttu-id="b6d62-134">Este patrón se aplica cuando una única operación requiere llamadas a varios servicios de back-end.</span><span class="sxs-lookup"><span data-stu-id="b6d62-134">This pattern applies when a single operation requires calls to multiple backend services.</span></span> <span data-ttu-id="b6d62-135">El cliente envía una solicitud a la puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="b6d62-135">The client sends one request to the gateway.</span></span> <span data-ttu-id="b6d62-136">La puerta de enlace envía las solicitudes a los distintos servicios de back-end y, después, agrega los resultados y los devuelve al cliente.</span><span class="sxs-lookup"><span data-stu-id="b6d62-136">The gateway dispatches requests to the various backend services, and then aggregates the results and sends them back to the client.</span></span> <span data-ttu-id="b6d62-137">Así se ayuda a reducir el intercambio de mensajes entre el cliente y el back-end.</span><span class="sxs-lookup"><span data-stu-id="b6d62-137">This helps to reduce chattiness between the client and the backend.</span></span> 

<span data-ttu-id="b6d62-138">[Descarga con puertas de enlace](../patterns/gateway-offloading.md).</span><span class="sxs-lookup"><span data-stu-id="b6d62-138">[Gateway Offloading](../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="b6d62-139">Use la puerta de enlace para descargar la funcionalidad de los servicios individuales a la puerta de enlace, especialmente cuando se dan cuestiones transversales.</span><span class="sxs-lookup"><span data-stu-id="b6d62-139">Use the gateway to offload functionality from individual services to the gateway, particularly cross-cutting concerns.</span></span> <span data-ttu-id="b6d62-140">Puede ser útil consolidar estas funciones en un solo lugar, en lugar de responsabilizar de su implementación a todos los servicios.</span><span class="sxs-lookup"><span data-stu-id="b6d62-140">It can be useful to consolidate these functions into one place, rather than making every service responsible for implementing them.</span></span> <span data-ttu-id="b6d62-141">En especial, esto es así en el caso de características que requieren habilidades especializadas para una implementación correcta, como la autenticación y la autorización.</span><span class="sxs-lookup"><span data-stu-id="b6d62-141">This is particularly true for features that requires specialized skills to implement correctly, such as authentication and authorization.</span></span> 

<span data-ttu-id="b6d62-142">Estos son algunos ejemplos de funcionalidad que puede descargar a una puerta de enlace:</span><span class="sxs-lookup"><span data-stu-id="b6d62-142">Here are some examples of functionality that could be offloaded to a gateway:</span></span>

- <span data-ttu-id="b6d62-143">Terminación de SSL</span><span class="sxs-lookup"><span data-stu-id="b6d62-143">SSL termination</span></span>
- <span data-ttu-id="b6d62-144">Autenticación</span><span class="sxs-lookup"><span data-stu-id="b6d62-144">Authentication</span></span>
- <span data-ttu-id="b6d62-145">Lista de direcciones IP permitidas</span><span class="sxs-lookup"><span data-stu-id="b6d62-145">IP whitelisting</span></span>
- <span data-ttu-id="b6d62-146">Limitación de la tasa de clientes</span><span class="sxs-lookup"><span data-stu-id="b6d62-146">Client rate limiting (throttling)</span></span>
- <span data-ttu-id="b6d62-147">Registro y supervisión</span><span class="sxs-lookup"><span data-stu-id="b6d62-147">Logging and monitoring</span></span>
- <span data-ttu-id="b6d62-148">Almacenamiento en caché de respuesta</span><span class="sxs-lookup"><span data-stu-id="b6d62-148">Response caching</span></span>
- <span data-ttu-id="b6d62-149">Firewall de aplicaciones web</span><span class="sxs-lookup"><span data-stu-id="b6d62-149">Web application firewall</span></span>
- <span data-ttu-id="b6d62-150">Compresión GZIP</span><span class="sxs-lookup"><span data-stu-id="b6d62-150">GZIP compression</span></span>
- <span data-ttu-id="b6d62-151">Mantenimiento de contenido estático</span><span class="sxs-lookup"><span data-stu-id="b6d62-151">Servicing static content</span></span>

## <a name="choosing-a-gateway-technology"></a><span data-ttu-id="b6d62-152">Elección de una tecnología de puerta de enlace</span><span class="sxs-lookup"><span data-stu-id="b6d62-152">Choosing a gateway technology</span></span>

<span data-ttu-id="b6d62-153">Aquí tiene algunas opciones para implementar una puerta de enlace de API en una aplicación.</span><span class="sxs-lookup"><span data-stu-id="b6d62-153">Here are some options for implementing an API gateway in your application.</span></span>

- <span data-ttu-id="b6d62-154">**Servidor de proxy inverso**.</span><span class="sxs-lookup"><span data-stu-id="b6d62-154">**Reverse proxy server**.</span></span> <span data-ttu-id="b6d62-155">Nginx y HAProxy son servidores de proxy inverso comunes que admiten características tales como el equilibrio de carga, SSL y enrutamiento de nivel 7.</span><span class="sxs-lookup"><span data-stu-id="b6d62-155">Nginx and HAProxy are popular reverse proxy servers that support features such as load balancing, SSL, and layer 7 routing.</span></span> <span data-ttu-id="b6d62-156">Ambos son productos gratuitos y de código abierto, con ediciones de pago que proporcionan características adicionales y opciones de soporte técnico.</span><span class="sxs-lookup"><span data-stu-id="b6d62-156">They are both free, open-source products, with paid editions that provide additional features and support options.</span></span> <span data-ttu-id="b6d62-157">Nginx y HAProxy son ambos productos consolidados con conjuntos variados de características y un rendimiento elevado.</span><span class="sxs-lookup"><span data-stu-id="b6d62-157">Nginx and HAProxy are both mature products with rich feature sets and high performance.</span></span> <span data-ttu-id="b6d62-158">Puede ampliarlos con módulos de terceros o escribiendo scripts personalizados en Lua.</span><span class="sxs-lookup"><span data-stu-id="b6d62-158">You can extend them with third-party modules or by writing custom scripts in Lua.</span></span> <span data-ttu-id="b6d62-159">Nginx también admite un módulo de scripting basado en JavaScript que se llama NginScript.</span><span class="sxs-lookup"><span data-stu-id="b6d62-159">Nginx also supports a JavaScript-based scripting module called NginScript.</span></span>

- <span data-ttu-id="b6d62-160">**Controlador de entrada del servicio de malla**.</span><span class="sxs-lookup"><span data-stu-id="b6d62-160">**Service mesh ingress controller**.</span></span> <span data-ttu-id="b6d62-161">Si utiliza un servicio malla como linkerd o Istio, tenga en cuenta las características que se proporcionan con el controlador de entrada para ese servicio malla.</span><span class="sxs-lookup"><span data-stu-id="b6d62-161">If you are using a service mesh such as linkerd or Istio, consider the features that are provided by the ingress controller for that service mesh.</span></span> <span data-ttu-id="b6d62-162">Por ejemplo, el controlador de entrada Istio admite enrutamiento de nivel 7, redirecciones HTTP, reintentos y otras características.</span><span class="sxs-lookup"><span data-stu-id="b6d62-162">For example, the Istio ingress controller supports layer 7 routing, HTTP redirects, retries, and other features.</span></span> 

- <span data-ttu-id="b6d62-163">[Azure Application Gateway](/azure/application-gateway/).</span><span class="sxs-lookup"><span data-stu-id="b6d62-163">[Azure Application Gateway](/azure/application-gateway/).</span></span> <span data-ttu-id="b6d62-164">Application Gateway es un servicio de equilibrio de carga administrada que puede realizar el enrutamiento de nivel 7 y la terminación SSL.</span><span class="sxs-lookup"><span data-stu-id="b6d62-164">Application Gateway is a managed load balancing service that can perform layer-7 routing and SSL termination.</span></span> <span data-ttu-id="b6d62-165">También proporciona un firewall de aplicación web (WAF).</span><span class="sxs-lookup"><span data-stu-id="b6d62-165">It also provides a web application firewall (WAF).</span></span>

- <span data-ttu-id="b6d62-166">[Azure API Management](/azure/api-management/).</span><span class="sxs-lookup"><span data-stu-id="b6d62-166">[Azure API Management](/azure/api-management/).</span></span> <span data-ttu-id="b6d62-167">Azure API Management es una solución completa para publicar API para clientes externos e internos.</span><span class="sxs-lookup"><span data-stu-id="b6d62-167">API Management is a turnkey solution for publishing APIs to external and internal customers.</span></span> <span data-ttu-id="b6d62-168">Proporciona características que resultan útiles para administrar una API expuesta al público, incluida la limitación de velocidad, la lista de direcciones IP permitidas y la autenticación con Azure Active Directory u otros proveedores de identidad.</span><span class="sxs-lookup"><span data-stu-id="b6d62-168">It provides features that are useful for managing a public-facing API, including rate limiting, IP white listing, and authentication using Azure Active Directory or other identity providers.</span></span> <span data-ttu-id="b6d62-169">API Management no realiza el equilibrio de carga, por lo que debe usarse junto con un equilibrador de carga como Application Gateway o un proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="b6d62-169">API Management doesn't perform any load balancing, so it should be used in conjunction with a load balancer such as Application Gateway or a reverse proxy.</span></span>

<span data-ttu-id="b6d62-170">Al elegir una tecnología de puerta de enlace, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b6d62-170">When choosing a gateway technology, consider the following:</span></span>

<span data-ttu-id="b6d62-171">**Características**.</span><span class="sxs-lookup"><span data-stu-id="b6d62-171">**Features**.</span></span> <span data-ttu-id="b6d62-172">Las opciones enumeradas antes admiten el enrutamiento de nivel 7, pero la compatibilidad con otras características variará.</span><span class="sxs-lookup"><span data-stu-id="b6d62-172">The options listed above all support layer 7 routing, but support for other features will vary.</span></span> <span data-ttu-id="b6d62-173">Según las características que necesite, puede implementar más de una puerta de enlace.</span><span class="sxs-lookup"><span data-stu-id="b6d62-173">Depending on the features that you need, you might deploy more than one gateway.</span></span> 

<span data-ttu-id="b6d62-174">**Implementación**.</span><span class="sxs-lookup"><span data-stu-id="b6d62-174">**Deployment**.</span></span> <span data-ttu-id="b6d62-175">Azure Application Gateway y API Management son servicios administrados.</span><span class="sxs-lookup"><span data-stu-id="b6d62-175">Azure Application Gateway and API Management are managed services.</span></span> <span data-ttu-id="b6d62-176">Nginx y HAProxy generalmente se ejecutarán en contenedores dentro del clúster, pero también se pueden implementar en máquinas virtuales dedicadas fuera.</span><span class="sxs-lookup"><span data-stu-id="b6d62-176">Nginx and HAProxy will typically run in containers inside the cluster, but can also be deployed to dedicated VMs outside of the cluster.</span></span> <span data-ttu-id="b6d62-177">Así se aísla la puerta de enlace del resto de la carga de trabajo, pero se genera una mayor sobrecarga de administración.</span><span class="sxs-lookup"><span data-stu-id="b6d62-177">This isolates the gateway from the rest of the workload, but incurs higher management overhead.</span></span>

<span data-ttu-id="b6d62-178">**Administración**.</span><span class="sxs-lookup"><span data-stu-id="b6d62-178">**Management**.</span></span> <span data-ttu-id="b6d62-179">Cuando los servicios se actualizan o se agregan otros nuevos, las reglas de enrutamiento de puerta de enlace tienen que actualizarse.</span><span class="sxs-lookup"><span data-stu-id="b6d62-179">When services are updated or new services are added, the gateway routing rules may need to be updated.</span></span> <span data-ttu-id="b6d62-180">Tenga en cuenta cómo se administrará este proceso.</span><span class="sxs-lookup"><span data-stu-id="b6d62-180">Consider how this process will be managed.</span></span> <span data-ttu-id="b6d62-181">Algunas consideraciones similares se aplican a la administración de certificados SSL, listas de direcciones IP permitidas y otros aspectos de la configuración.</span><span class="sxs-lookup"><span data-stu-id="b6d62-181">Similar considerations apply to managing SSL certificates, IP whitelists, and other aspects of configuration.</span></span>

## <a name="deployment-considerations"></a><span data-ttu-id="b6d62-182">Consideraciones de la implementación</span><span class="sxs-lookup"><span data-stu-id="b6d62-182">Deployment considerations</span></span>

### <a name="deploying-nginx-or-haproxy-to-kubernetes"></a><span data-ttu-id="b6d62-183">Implementación de Nginx o HAProxy en Kubernetes</span><span class="sxs-lookup"><span data-stu-id="b6d62-183">Deploying Nginx or HAProxy to Kubernetes</span></span>

<span data-ttu-id="b6d62-184">Puede implementar Nginx o HAProxy en Kubernetes como [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) o [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) que especifica la imagen de contenedor de Nginx o HAProxy.</span><span class="sxs-lookup"><span data-stu-id="b6d62-184">You can deploy Nginx or HAProxy to Kubernetes as a [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) or [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) that specifies the Nginx or HAProxy container image.</span></span> <span data-ttu-id="b6d62-185">Use ConfigMap para almacenar el archivo de configuración del proxy y móntelo como un volumen.</span><span class="sxs-lookup"><span data-stu-id="b6d62-185">Use a ConfigMap to store the configuration file for the proxy, and mount the ConfigMap as a volume.</span></span> <span data-ttu-id="b6d62-186">Cree un servicio del tipo del equilibrador de carga para exponer la puerta de enlace a través de Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="b6d62-186">Create a service of type LoadBalancer to expose the gateway through an Azure Load Balancer.</span></span> 

<!-- - Configure a readiness probe that serves a static file from the gateway (rather than routing to another service). -->

<span data-ttu-id="b6d62-187">Una alternativa es crear un recurso Ingress Controller.</span><span class="sxs-lookup"><span data-stu-id="b6d62-187">An alternative is to create an Ingress Controller.</span></span> <span data-ttu-id="b6d62-188">Se trata de un recurso de Kubernetes que implementa un servidor proxy inverso o un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b6d62-188">An Ingress Controller is a Kubernetes resource that deploys a load balancer or reverse proxy server.</span></span> <span data-ttu-id="b6d62-189">Existen varias implementaciones, como son Nginx y HAProxy.</span><span class="sxs-lookup"><span data-stu-id="b6d62-189">Several implementations exist, including Nginx and HAProxy.</span></span> <span data-ttu-id="b6d62-190">Un recurso independiente denominado elemento Ingress define la configuración de Ingress Controller, tales como las reglas de enrutamiento y los certificados TLS.</span><span class="sxs-lookup"><span data-stu-id="b6d62-190">A separate resource called an Ingress defines settings for the Ingress Controller, such as routing rules and TLS certificates.</span></span> <span data-ttu-id="b6d62-191">De este modo, no es necesario administrar los complejos archivos de configuración específicos de una tecnología de servidor proxy determinada.</span><span class="sxs-lookup"><span data-stu-id="b6d62-191">That way, you don't need to manage complex configuration files that are specific to a particular proxy server technology.</span></span> <span data-ttu-id="b6d62-192">Ingress Controllers sigue siendo una característica beta de Kubernetes en el momento de redactar este artículo y continuará evolucionando.</span><span class="sxs-lookup"><span data-stu-id="b6d62-192">Ingress Controllers are still a beta feature of Kubernetes at the time of this writing, and the feature will continue to evolve.</span></span>

<span data-ttu-id="b6d62-193">La puerta de enlace es un posible cuello de botella o un único punto de error en el sistema, por lo que siempre debe implementar al menos dos réplicas para lograr una elevada disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="b6d62-193">The gateway is a potential bottleneck or single point of failure in the system, so always deploy at least two replicas for high availability.</span></span> <span data-ttu-id="b6d62-194">Puede que deba escalar horizontalmente las réplicas todavía más, según la carga.</span><span class="sxs-lookup"><span data-stu-id="b6d62-194">You may need to scale out the replicas further, depending on the load.</span></span> 

<span data-ttu-id="b6d62-195">Considere también ejecutar la puerta de enlace en un conjunto dedicado de nodos del clúster.</span><span class="sxs-lookup"><span data-stu-id="b6d62-195">Also consider running the gateway on a dedicated set of nodes in the cluster.</span></span> <span data-ttu-id="b6d62-196">Las ventajas de este enfoque incluyen:</span><span class="sxs-lookup"><span data-stu-id="b6d62-196">Benefits to this approach include:</span></span>

- <span data-ttu-id="b6d62-197">Aislamiento.</span><span class="sxs-lookup"><span data-stu-id="b6d62-197">Isolation.</span></span> <span data-ttu-id="b6d62-198">Todo el tráfico entrante va a un conjunto fijo de nodos, que se pueden aislar de los servicios de back-end.</span><span class="sxs-lookup"><span data-stu-id="b6d62-198">All inbound traffic goes to a fixed set of nodes, which can be isolated from backend services.</span></span>

- <span data-ttu-id="b6d62-199">Configuración estable.</span><span class="sxs-lookup"><span data-stu-id="b6d62-199">Stable configuration.</span></span> <span data-ttu-id="b6d62-200">Si la puerta de enlace está mal configurada, toda la aplicación podría dejar de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="b6d62-200">If the gateway is misconfigured, the entire application may become unavailable.</span></span> 

- <span data-ttu-id="b6d62-201">Rendimiento.</span><span class="sxs-lookup"><span data-stu-id="b6d62-201">Performance.</span></span> <span data-ttu-id="b6d62-202">Puede utilizar una configuración de máquina virtual específica para la puerta de enlace por motivos de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="b6d62-202">You may want to use a specific VM configuration for the gateway for performance reasons.</span></span>

<!-- - Load balancing. You can configure the external load balancer so that requests always go to a gateway node. That can save a network hop, which would otherwise happen whenever a request lands on a node that isn't running a gateway pod. This consideration applies mainly to large clusters, where the gateway runs on a relatively small fraction of the total nodes. In Azure Container Service (ACS), this approach currently requires [ACS Engine](https://github.com/Azure/acs-engine)) which allows you to create multiple agent pools. Then you can deploy the gateway as a DaemonSet to the front-end pool. -->

### <a name="azure-application-gateway"></a><span data-ttu-id="b6d62-203">Azure Application Gateway</span><span class="sxs-lookup"><span data-stu-id="b6d62-203">Azure Application Gateway</span></span>

<span data-ttu-id="b6d62-204">Para conectar Application Gateway a un clúster de Kubernetes de Azure:</span><span class="sxs-lookup"><span data-stu-id="b6d62-204">To connect Application Gateway to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="b6d62-205">Cree una subred vacía en la red virtual del clúster.</span><span class="sxs-lookup"><span data-stu-id="b6d62-205">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="b6d62-206">Implemente Application Gateway.</span><span class="sxs-lookup"><span data-stu-id="b6d62-206">Deploy Application Gateway.</span></span>
3. <span data-ttu-id="b6d62-207">Cree un servicio de Kubernetes con el tipo =[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span><span class="sxs-lookup"><span data-stu-id="b6d62-207">Create a Kubernetes service with type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span></span> <span data-ttu-id="b6d62-208">Así se expone el servicio en cada nodo para que se pueda llegar desde fuera del clúster.</span><span class="sxs-lookup"><span data-stu-id="b6d62-208">This exposes the service on each node so that it can be reached from outside the cluster.</span></span> <span data-ttu-id="b6d62-209">No crea un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b6d62-209">It does not create a load balancer.</span></span>
5. <span data-ttu-id="b6d62-210">Obtenga el número de puerto asignado para el servicio.</span><span class="sxs-lookup"><span data-stu-id="b6d62-210">Get the assigned port number for the service.</span></span>
6. <span data-ttu-id="b6d62-211">Agregue una regla de Application Gateway en la que:</span><span class="sxs-lookup"><span data-stu-id="b6d62-211">Add an Application Gateway rule where:</span></span>
    - <span data-ttu-id="b6d62-212">El grupo de back-end contenga las máquinas virtuales del agente.</span><span class="sxs-lookup"><span data-stu-id="b6d62-212">The backend pool contains the agent VMs.</span></span>
    - <span data-ttu-id="b6d62-213">La configuración HTTP especifique el número de puerto de servicio.</span><span class="sxs-lookup"><span data-stu-id="b6d62-213">The HTTP setting specifies the service port number.</span></span>
    - <span data-ttu-id="b6d62-214">El agente de escucha de la puerta de enlace realice escuchas en los puertos 80 y 443.</span><span class="sxs-lookup"><span data-stu-id="b6d62-214">The gateway listener listens on ports 80/443</span></span>
    
<span data-ttu-id="b6d62-215">Establezca el número de instancias en dos o más para lograr una elevada disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="b6d62-215">Set the instance count to 2 or more for high availability.</span></span>

### <a name="azure-api-management"></a><span data-ttu-id="b6d62-216">Azure API Management</span><span class="sxs-lookup"><span data-stu-id="b6d62-216">Azure API Management</span></span> 

<span data-ttu-id="b6d62-217">Para conectar API Management a un clúster de Kubernetes en Azure:</span><span class="sxs-lookup"><span data-stu-id="b6d62-217">To connect API Management to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="b6d62-218">Cree una subred vacía en la red virtual del clúster.</span><span class="sxs-lookup"><span data-stu-id="b6d62-218">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="b6d62-219">Implemente API Management en esa subred.</span><span class="sxs-lookup"><span data-stu-id="b6d62-219">Deploy API Management to that subnet.</span></span>
3. <span data-ttu-id="b6d62-220">Cree un servicio de Kubernetes del tipo LoadBalancer (equilibrador de carga).</span><span class="sxs-lookup"><span data-stu-id="b6d62-220">Create a Kubernetes service of type LoadBalancer.</span></span> <span data-ttu-id="b6d62-221">Use la anotación del [equilibrador de carga interno](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) para crear uno de ese tipo, en lugar de uno expuesto a Internet, que es lo predeterminado.</span><span class="sxs-lookup"><span data-stu-id="b6d62-221">Use the [internal load balancer](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) annotation to create an internal load balancer, instead of an Internet-facing load balancer, which is the default.</span></span>
4. <span data-ttu-id="b6d62-222">Busque la dirección IP privada del equilibrador de carga interno, mediante kubectl o la CLI de Azure.</span><span class="sxs-lookup"><span data-stu-id="b6d62-222">Find the private IP of the internal load balancer, using kubectl or the Azure CLI.</span></span>
5. <span data-ttu-id="b6d62-223">Use API Management para crear una API que dirija a la dirección IP privada del equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b6d62-223">Use API Management to create an API that directs to the private IP address of the load balancer.</span></span>

<span data-ttu-id="b6d62-224">Considere la posibilidad de combinar API Management con un proxy inverso, ya sea Nginx, HAProxy o Azure Application Gateway.</span><span class="sxs-lookup"><span data-stu-id="b6d62-224">Consider combining API Management with a reverse proxy, whether Nginx, HAProxy, or Azure Application Gateway.</span></span> <span data-ttu-id="b6d62-225">Para obtener información acerca del uso de API Management con Application Gateway, consulte [Integración de API Management en una red virtual interna con Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span><span class="sxs-lookup"><span data-stu-id="b6d62-225">For information about using API Management with Application Gateway, see [Integrate API Management in an internal VNET with Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="b6d62-226">Registro y supervisión</span><span class="sxs-lookup"><span data-stu-id="b6d62-226">Logging and monitoring</span></span>](./logging-monitoring.md)
